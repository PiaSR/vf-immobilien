import { c as createSvgComponent, $ as $$MainLayout } from '../../chunks/MainLayout_DU7Rr5R3.mjs';
import { c as createComponent, a as renderTemplate, f as defineScriptVars, r as renderComponent, e as addAttribute, m as maybeRenderHead } from '../../chunks/astro/server_lfFasKkK.mjs';
import 'piccolore';
import { $ as $$Image } from '../../chunks/_astro_assets_B2RpSsLg.mjs';
import { s as sanityClient } from '../../chunks/sanityClient_DUM2tGat.mjs';
/* empty css                                             */
import 'clsx';
import { $ as $$HeroHeader } from '../../chunks/HeroHeader_CLQrIJ7L.mjs';
export { renderers } from '../../renderers.mjs';

const SearchIcon = createSvgComponent({"meta":{"src":"/_astro/search_24dp_FFF_FILL0_wght400_GRAD0_opsz24.CbVDWhHx.svg","width":24,"height":24,"format":"svg"},"attributes":{"height":"24px","viewBox":"0 -960 960 960","width":"24px","fill":"#fff"},"children":"<path d=\"M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z\" />"});

var __freeze$1 = Object.freeze;
var __defProp$1 = Object.defineProperty;
var __template$1 = (cooked, raw) => __freeze$1(__defProp$1(cooked, "raw", { value: __freeze$1(raw || cooked.slice()) }));
var _a$1;
const $$PropertiesFilterSearch = createComponent(async ($$result, $$props, $$slots) => {
  const viennaDistricts = [
    "1. Innere Stadt",
    "2. Leopoldstadt",
    "3. Landstra\xDFe",
    "4. Wieden",
    "5. Margareten",
    "6. Mariahilf",
    "7. Neubau",
    "8. Josefstadt",
    "9. Alsergrund",
    "10. Favoriten",
    "11. Simmering",
    "12. Meidling",
    "13. Hietzing",
    "14. Penzing",
    "15. Rudolfsheim-F\xFCnfhaus",
    "16. Ottakring",
    "17. Hernals",
    "18. W\xE4hring",
    "19. D\xF6bling",
    "20. Brigittenau",
    "21. Floridsdorf",
    "22. Donaustadt",
    "23. Liesing"
  ];
  const filterOptionsQuery = `{
    // Fetch property type options (still reliable if a property exists)
    "propertyTypes": *[_type == "propertyType"].title,
    "amenities": *[_type == "ausstattung"].title,
    "surroundingDistrictsRaw": *[_type == "property"].locationSurrounding
}`;
  let filterData = {
    propertyType: [],
    amenities: [],
    surroundingDistrictsRaw: []
  };
  try {
    filterData = await sanityClient.fetch(filterOptionsQuery);
  } catch (e) {
    console.error("Failed to fetch filter options from Sanity:", e);
  }
  const objektarten = filterData.propertyType || [
    "Wohnung",
    "Haus",
    "Grundstueck",
    "Parkplatz",
    "Gewerbeimmobilie"
  ];
  const amenities = filterData.amenities || [];
  const rawSurrounding = filterData.surroundingDistrictsRaw || [];
  const surroundingDistricts = Array.from(
    new Set(
      // Filter out null/undefined values (loc is string => !!loc), then create a unique Set
      rawSurrounding.filter((loc) => !!loc)
    )
  );
  const districts = {
    Wien: viennaDistricts,
    // Now using the hardcoded list
    Nieder\u00F6sterreich: surroundingDistricts
  };
  const capitalize = (s) => s.charAt(0).toUpperCase() + s.slice(1).replace(/-/g, " ");
  const allLocations = [...viennaDistricts, ...surroundingDistricts];
  return renderTemplate(_a$1 || (_a$1 = __template$1(["", '<section id="properties-filter" class="section-properties-filter-form" data-astro-cid-dtgl45ca> <div class="properties-filter-wrapper" data-astro-cid-dtgl45ca> <div id="property-filter-form" class="form-block" data-astro-cid-dtgl45ca> <form id="property-filter-form-element" name="property-filter-form" class="form" data-astro-cid-dtgl45ca> <div id="mobile-summary-bar" class="filter-heading-tab" data-astro-cid-dtgl45ca> <div id="mobile-summary-text" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nAlle Filter Optionen\n</div> <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor" data-astro-cid-dtgl45ca><path d="M440-160q-17 0-28.5-11.5T400-200v-240L168-736q-15-20-4.5-42t36.5-22h560q26 0 36.5 22t-4.5 42L560-440v240q0 17-11.5 28.5T520-160h-80Zm40-308 198-252H282l198 252Zm0 0Z" data-astro-cid-dtgl45ca></path></svg> <!-- Add an icon here if desired, like an arrow down --> </div> <div id="mobile-expanded-content" data-astro-cid-dtgl45ca> <div id="filter-heading-bar" class="filter-heading-bar" data-astro-cid-dtgl45ca> <div class="mobile-close-button-wrapper" data-astro-cid-dtgl45ca> <button id="mobile-close-button" type="button" aria-label="Filter schlie\xDFen" data-astro-cid-dtgl45ca>\n&times;\n</button> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="immobilie" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Immobilie</div> <div id="selection-immobilie" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nAlle Kategorien\n</div> </div> <div id="panel-immobilie" class="filter-panel panel-immobilie" data-astro-cid-dtgl45ca> <div id="filter-vermarktungsart" class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Vermarktungsart</h2> <div class="filter-form-input-wrapper radio-input-group" data-astro-cid-dtgl45ca> <label class="radio-classic-label" data-astro-cid-dtgl45ca> <input type="radio" name="vermarktungsart" value="miete" data-astro-cid-dtgl45ca>Miete\n</label> <label class="radio-classic-label" data-astro-cid-dtgl45ca> <input type="radio" name="vermarktungsart" value="kauf" data-astro-cid-dtgl45ca>Kauf\n</label> </div> </div> <div id="filter-objektart" class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Objektart</h2>  ', ' </div> <a href="#" data-panel="immobilie" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="ort" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Ort</div> <div id="selection-ort" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nAlle Orte\n</div> </div> <div id="panel-ort" class="filter-panel panel-ort" data-astro-cid-dtgl45ca> ', ' <a href="#" data-panel="ort" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="groesse" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Gr\xF6\xDFe</div> <div id="selection-groesse" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nJede Gr\xF6\xDFe\n</div> </div> <div id="panel-groesse" class="filter-panel panel-groesse" data-astro-cid-dtgl45ca> <div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Zimmer</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="zimmer-min" placeholder="Min" type="number" id="filter-zimmer-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="zimmer-max" placeholder="Max" type="number" id="filter-zimmer-max" data-astro-cid-dtgl45ca> </div> </div> <div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Fl\xE4che (m\xB2)</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="flaeche-min" placeholder="Min" type="number" id="filter-flaeche-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="flaeche-max" placeholder="Max" type="number" id="filter-flaeche-max" data-astro-cid-dtgl45ca> </div> </div> <a href="#" data-panel="groesse" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="preis" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Preis</div> <div id="selection-preis" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nJeder Preis\n</div> </div> <div id="panel-preis" class="filter-panel panel-preis" data-astro-cid-dtgl45ca>  <div class="filter-form-group price-group price-group-kauf" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Kaufpreis (\u20AC)</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="preis-kauf-min" placeholder="Min" type="number" id="filter-preis-kauf-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="preis-kauf-max" placeholder="Max" type="number" id="filter-preis-kauf-max" data-astro-cid-dtgl45ca> </div> </div> <div class="filter-form-group price-group price-group-miete" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Miete (\u20AC)</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="preis-miete-min" placeholder="Min" type="number" id="filter-preis-miete-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="preis-miete-max" placeholder="Max" type="number" id="filter-preis-miete-max" data-astro-cid-dtgl45ca> </div> </div> <a href="#" data-panel="preis" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="ausstattung" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Ausstattung</div> <div id="selection-ausstattung" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nDetails\n</div> </div> <div id="panel-ausstattung" class="filter-panel panel-ausstattung" data-astro-cid-dtgl45ca> <div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Details</h2> <div class="filter-form-input-wrapper checkbox-columns" data-astro-cid-dtgl45ca> <div class="checkbox-column" data-astro-cid-dtgl45ca> ', ' </div> <div class="checkbox-column" data-astro-cid-dtgl45ca> ', ' </div> </div> </div> <a href="#" data-panel="ausstattung" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div id="search-button" class="search-button-wrapper" data-astro-cid-dtgl45ca> <button type="submit" class="custom-submit-button" data-astro-cid-dtgl45ca> ', "\nSuchen\n</button> </div> </div> </div> </form> </div> </div> </section>  <script>(function(){", '\ndocument.addEventListener("DOMContentLoaded", () => {\n  const filterBar = document.getElementById("filter-heading-bar");\n  const formElement = document.getElementById("property-filter-form-element");\n  const mobileSummaryBar = document.getElementById("mobile-summary-bar");\n  const mobileSummaryText = document.getElementById("mobile-summary-text");\n  const mobileCloseButton = document.getElementById("mobile-close-button"); // NEW\n  const priceGroupKauf = document.querySelector(".price-group-kauf");\n  const priceGroupMiete = document.querySelector(".price-group-miete");\n\n  // Define allTabs here for use in updateMobileSummaryText and listeners\n  const tabsContainer = document.getElementById("filter-heading-bar");\n  const allTabs = tabsContainer\n    ? tabsContainer.querySelectorAll(\n      ".filter-heading-tab:not(#mobile-summary-bar)"\n    )\n    : [];\n\n  // Get references to the selection text elements\n  const selectionImmobilie = document.getElementById("selection-immobilie");\n  const selectionOrt = document.getElementById("selection-ort");\n  const selectionGroesse = document.getElementById("selection-groesse");\n  const selectionPreis = document.getElementById("selection-preis");\n  const selectionAusstattung = document.getElementById(\n    "selection-ausstattung"\n  );\n\n  // --- GLOBAL STATE ---\n  let activePanelId = null; // Store ID of currently active panel (e.g., \'panel-immobilie\')\n  let activeTabElement = null; // Store reference to the currently active tab element\n\n  // Safety check\n  if (\n    !filterBar ||\n    !formElement ||\n    !priceGroupKauf ||\n    !priceGroupMiete ||\n    !selectionImmobilie ||\n    !selectionOrt ||\n    !selectionGroesse ||\n    !selectionPreis ||\n    !selectionAusstattung\n  )\n    return;\n\n  // --- Utility Function: Check for Mobile/Desktop View ---\n  const isDesktop = () => window.matchMedia("(min-width: 992px)").matches;\n\n  // --- DYNAMIC POSITIONING LOGIC (DESKTOP ONLY) ---\n  /**\n   * Calculates the position of the selected tab and moves the filter panel directly beneath it.\n   * @param {HTMLElement} targetTab The tab element to align the panel under.\n   * @param {HTMLElement} panelElement The panel element to position.\n   */\n  function positionPanel(targetTab, panelElement) {\n    if (!isDesktop()) return; // Only apply dynamic positioning on desktop\n\n    const filterBarRect = filterBar.getBoundingClientRect();\n    const formRect = formElement.getBoundingClientRect();\n\n    // The newLeft is the distance from the form\'s left edge to the filterBar\'s left edge.\n    const newLeft = filterBarRect.left - formRect.left;\n\n    // The newTop must place the panel at the bottom of the filter bar.\n    const newTop = filterBar.offsetTop + filterBar.offsetHeight + 4; // Add a small gap (4px)\n\n    // Apply the new position\n    panelElement.style.left = `${newLeft}px`;\n    panelElement.style.top = `${newTop}px`;\n  }\n\n  // --- Utility Function: Get Value or Null ---\n  const getInputValue = (name) => {\n    const input = formElement.querySelector(`[name="${name}"]`);\n    // @ts-ignore\n    return input?.value ? input.value : null;\n  };\n\n  // --- Utility Function: Format Price ---\n  const formatPrice = (price) => {\n    if (price === null || isNaN(Number(price))) return "";\n    return new Intl.NumberFormat("de-DE", {\n      maximumFractionDigits: 0,\n    }).format(Number(price));\n  };\n\n  // --- Utility Function: Reset Form Fields ---\n  const resetAllFormFields = () => {\n    formElement.querySelectorAll("input, select").forEach((input) => {\n      // @ts-ignore\n      if (input.type === "checkbox" || input.type === "radio") {\n        // Uncheck all checkboxes and radios\n        input.checked = false;\n      } else if (input.tagName === "SELECT") {\n        input.selectedIndex = 0;\n      } else {\n        // Reset text and number inputs\n        input.value = "";\n      }\n    });\n  };\n\n  // --- MOBILE LOGIC: Update the collapsed summary bar text (MODIFIED) ---\n  function updateMobileSummaryText() {\n    // Check if we are on mobile view\n    if (!mobileSummaryText || isDesktop()) return;\n\n    const selections = Array.from(allTabs)\n      .map((tab) => {\n        const selectionElement = tab.querySelector(\n          ".filter-heading-tab-selection"\n        );\n        return selectionElement ? selectionElement.textContent : "";\n      })\n      .filter(\n        (text) =>\n          text &&\n          text.trim() !== "Alle Kategorien" &&\n          text.trim() !== "Alle Orte" &&\n          text.trim() !== "Jede Gr\xF6\xDFe" &&\n          text.trim() !== "Jeder Preis" &&\n          text.trim() !== "Details"\n      );\n\n    if (selections.length > 0) {\n      mobileSummaryText.textContent = selections.join(", ");\n    } else {\n      mobileSummaryText.textContent = "Alle Filter Optionen";\n    }\n  }\n\n  function closeMobileModal() {\n    if (isDesktop()) return;\n\n    // 1. Collapse the entire menu (modal)\n    formElement.classList.remove("is-expanded");\n    document.body.classList.remove("is-filter-active");\n\n    // 2. Ensure all panels and active states are closed\n    document\n      .querySelectorAll(".filter-panel")\n      .forEach((p) => p.classList.remove("active"));\n    document\n      .querySelectorAll(".filter-heading-tab")\n      .forEach((t) => t.classList.remove("active"));\n\n    activePanelId = null;\n    activeTabElement = null;\n  }\n\n  function handleMobileSummaryClick() {\n    const isExpanded = formElement.classList.contains("is-expanded");\n\n    if (isDesktop()) return;\n\n    if (!isExpanded) {\n      // Step 1: Expand the entire menu\n      formElement.classList.add("is-expanded");\n\n      // Step 2: Automatically open the first panel (\'immobilie\')\n      const firstTab = document.querySelector(\'[data-tab="immobilie"]\');\n      if (firstTab) {\n        // Use a short delay to ensure expansion transition starts before panel opens\n        setTimeout(() => {\n          // Pass true to force the panel to open\n          togglePanel(firstTab, true);\n        }, 50);\n      }\n    } else {\n      // If expanded, clicking the summary bar collapses the filter entirely\n      formElement.classList.remove("is-expanded");\n\n      // Ensure all panels and active states are closed\n      document\n        .querySelectorAll(".filter-panel")\n        .forEach((p) => p.classList.remove("active"));\n      document\n        .querySelectorAll(".filter-heading-tab")\n        .forEach((t) => t.classList.remove("active"));\n\n      activePanelId = null;\n      activeTabElement = null;\n      document.body.classList.remove("is-filter-active");\n    }\n  }\n\n  // --- CORE LOGIC: UPDATE TAB SELECTION TEXTS ---\n  const updateTabSelections = () => {\n    const formData = new FormData(formElement);\n\n    // --- 1. IMMOBILIE (vermarktungsart, objektart) ---\n    const vmArt = formData.get("vermarktungsart");\n    const objArts = formData.getAll("objektart").filter((v) => v.length > 0);\n\n    let immobilietext = "Alle Kategorien";\n    const vmAction = vmArt === "miete" ? "mieten" : "kaufen";\n    const vmType = vmArt === "miete" ? "Mieten" : "Kaufen";\n\n    if (vmArt && objArts.length === 0) {\n      immobilietext = vmType;\n    } else if (vmArt && objArts.length === 1) {\n      immobilietext = `${objArts[0]} ${vmAction}`;\n    } else if (vmArt && objArts.length > 1) {\n      immobilietext = `${objArts.length} Objektarten ${vmAction}`;\n    } else if (!vmArt && objArts.length === 1) {\n      immobilietext = objArts[0];\n    } else if (!vmArt && objArts.length > 1) {\n      immobilietext = `${objArts.length} Objektarten`;\n    }\n\n    selectionImmobilie.textContent = immobilietext;\n\n    // --- 2. ORT (lage) ---\n    const selectedLages = formData.getAll("lage").filter((v) => v.length > 0);\n    let ortText = "Alle Orte";\n\n    if (selectedLages.length === 1) {\n      const selectedLage = selectedLages[0];\n      // Note: viennaDistricts is expected to be available in this scope via define:vars\n      // Assuming capitalization is handled externally or not critical here\n      if (\n        Array.isArray(viennaDistricts) &&\n        viennaDistricts.includes(selectedLage)\n      ) {\n        ortText = selectedLage;\n      } else {\n        ortText = selectedLage;\n      }\n    } else if (selectedLages.length > 1) {\n      ortText = `${selectedLages.length} Orte`;\n    }\n\n    selectionOrt.textContent = ortText;\n\n    // --- 3. GR\xD6SSE (zimmer, flaeche) ---\n    let zimmerMin = getInputValue("zimmer-min");\n    let zimmerMax = getInputValue("zimmer-max");\n    let flaecheMin = getInputValue("flaeche-min");\n    let flaecheMax = getInputValue("flaeche-max");\n\n    let zimmerText = "";\n    if (zimmerMin && zimmerMax) {\n      zimmerText = `${zimmerMin} - ${zimmerMax} Zimmer`;\n    } else if (zimmerMin) {\n      zimmerText = `ab ${zimmerMin} Zimmer`;\n    } else if (zimmerMax) {\n      zimmerText = `bis ${zimmerMax} Zimmer`;\n    }\n\n    let flaecheText = "";\n    if (flaecheMin && flaecheMax) {\n      flaecheText = `${flaecheMin} - ${flaecheMax} m\xB2`;\n    } else if (flaecheMin) {\n      flaecheText = `ab ${flaecheMin} m\xB2`;\n    } else if (flaecheMax) {\n      flaecheText = `bis ${flaecheMax} m\xB2`;\n    }\n\n    let groesseText = "Jede Gr\xF6\xDFe";\n    if (zimmerText && flaecheText) {\n      groesseText = `${zimmerText}, ${flaecheText}`;\n    } else if (zimmerText) {\n      groesseText = zimmerText;\n    } else if (flaecheText) {\n      groesseText = flaecheText;\n    }\n\n    selectionGroesse.textContent = groesseText;\n\n    // --- 4. PREIS (price-kauf/miete) ---\n    let kaufMin = getInputValue("preis-kauf-min");\n    let kaufMax = getInputValue("preis-kauf-max");\n    let mieteMin = getInputValue("preis-miete-min");\n    let mieteMax = getInputValue("preis-miete-max");\n\n    let kaufRange = "";\n    let mieteRange = "";\n\n    if (kaufMin || kaufMax) {\n      if (kaufMin && kaufMax) {\n        kaufRange = `${formatPrice(kaufMin)} - ${formatPrice(kaufMax)} \u20AC`;\n      } else if (kaufMin) {\n        kaufRange = `ab ${formatPrice(kaufMin)} \u20AC`;\n      } else if (kaufMax) {\n        kaufRange = `bis ${formatPrice(kaufMax)} \u20AC`;\n      }\n    }\n\n    if (mieteMin || mieteMax) {\n      if (mieteMin && mieteMax) {\n        mieteRange = `${formatPrice(mieteMin)} - ${formatPrice(mieteMax)} \u20AC/Monat`;\n      } else if (mieteMin) {\n        mieteRange = `ab ${formatPrice(mieteMin)} \u20AC/Monat`;\n      } else if (mieteMax) {\n        mieteRange = `bis ${formatPrice(mieteMax)} \u20AC/Monat`;\n      }\n    }\n\n    let preisText = "Jeder Preis";\n\n    if (vmArt === "kauf") {\n      preisText = kaufRange || "Jeder Preis";\n    } else if (vmArt === "miete") {\n      preisText = mieteRange.replace("/Monat", "") || "Jeder Preis";\n    } else {\n      if (kaufRange && mieteRange) {\n        preisText = "Kauf & Miete";\n      } else if (kaufRange) {\n        preisText = kaufRange;\n      } else if (mieteRange) {\n        preisText = mieteRange.replace("/Monat", "");\n      }\n    }\n    selectionPreis.textContent = preisText;\n\n    // --- 5. AUSSTATTUNG (ausstattung) ---\n    const selectedAmenities = formData\n      .getAll("ausstattung")\n      .filter((v) => v.length > 0);\n    let ausstattungText = "Details";\n\n    if (selectedAmenities.length === 1) {\n      // Assuming a capitalize function exists or just use the raw value\n      ausstattungText = selectedAmenities[0]; // Removed capitalize() for safety\n    } else if (selectedAmenities.length > 1) {\n      ausstattungText = `${selectedAmenities.length} Details`;\n    }\n    selectionAusstattung.textContent = ausstattungText;\n\n    // Always update the mobile summary bar after updating individual selections\n    updateMobileSummaryText();\n  };\n\n  // --- Price Group Visibility Logic (Used on init and on \'immobilie\' change) ---\n  function handleVermarktungsartChange() {\n    const vmArt = getInputValue("vermarktungsart");\n\n    // Hide both first\n    priceGroupKauf.classList.add("hidden");\n    priceGroupMiete.classList.add("hidden");\n\n    if (vmArt === "miete") {\n      priceGroupMiete.classList.remove("hidden");\n    } else if (vmArt === "kauf") {\n      priceGroupKauf.classList.remove("hidden");\n    } else {\n      // Show both if nothing is selected (default)\n      priceGroupKauf.classList.remove("hidden");\n      priceGroupMiete.classList.remove("hidden");\n    }\n  }\n\n  // --- CORE LOGIC: TOGGLE PANEL VISIBILITY (MODIFIED) ---\n  /**\n   * Toggles the visibility and active state of a filter tab and its associated panel.\n   * @param {HTMLElement} targetTab The tab element that was clicked.\n   * @param {boolean} [forceOpen=false] If true, forces the panel to open even if it\'s currently inactive.\n   */\n  function togglePanel(targetTab, forceOpen = false) {\n    const tabName = targetTab.getAttribute("data-tab");\n    const panelId = `panel-${tabName}`;\n    const panelElement = document.getElementById(panelId);\n\n    if (!panelElement) return;\n\n    const isActive = targetTab.classList.contains("active");\n    const isMobileView = !isDesktop();\n\n    // 1. Determine if we should OPEN or CLOSE\n    const shouldOpen = forceOpen || !isActive;\n\n    // 2. Close All First\n    document.querySelectorAll(".filter-panel").forEach((p) => {\n      p.classList.remove("active");\n      if (!isMobileView) {\n        // Only manipulate display property on Desktop\n        p.style.display = "none";\n      }\n    });\n    document.querySelectorAll(".filter-heading-tab").forEach((t) => {\n      t.classList.remove("active");\n    });\n\n    // 3. Open or Remain Closed\n    if (shouldOpen) {\n      // Open the new panel\n      targetTab.classList.add("active");\n      panelElement.classList.add("active");\n\n      if (!isMobileView) {\n        // Desktop logic: Show and Position\n        panelElement.style.display = "block";\n        positionPanel(targetTab, panelElement);\n        document.body.classList.add("is-filter-active");\n      }\n\n      activePanelId = panelId;\n      activeTabElement = targetTab;\n    } else {\n      // Panel was active and clicked again -> close it\n      activePanelId = null;\n      activeTabElement = null;\n      document.body.classList.remove("is-filter-active");\n    }\n\n    handleVermarktungsartChange();\n  }\n\n  // --- CORE LOGIC: SETUP EVENT LISTENERS ---\n  const setupEventListeners = () => {\n    // NEW: Attach listener to the mobile summary bar\n    if (mobileSummaryBar) {\n      mobileSummaryBar.addEventListener("click", handleMobileSummaryClick);\n    }\n    if (mobileCloseButton) {\n      mobileCloseButton.addEventListener("click", closeMobileModal);\n    }\n\n    // Listen for tab clicks to toggle panels (MODIFIED)\n    filterBar.addEventListener("click", (e) => {\n      const targetTab = e.target.closest(".tab-container");\n      if (!targetTab) return;\n\n      const isMobileExpanded = formElement.classList.contains("is-expanded");\n\n      if (!isDesktop()) {\n        // On mobile, only allow tab clicks if the menu is expanded\n        if (isMobileExpanded) {\n          togglePanel(targetTab);\n        }\n      } else {\n        // Desktop behavior\n        togglePanel(targetTab);\n      }\n    });\n\n    document.querySelectorAll(".reset-button").forEach((button) => {\n      button.addEventListener("click", (e) => {\n        e.preventDefault();\n\n        resetAllFormFields();\n\n        // Update UI\n        updateTabSelections();\n        handleVermarktungsartChange();\n\n        // Dispatch filter event\n        const formData = new FormData(formElement);\n        const filterEvent = new CustomEvent("filter:submit", {\n          detail: { formData: formData },\n        });\n        document.dispatchEvent(filterEvent);\n      });\n    });\n\n    // --- Global click listener to close panel when clicking outside (Desktop only) ---\n    document.addEventListener("click", (e) => {\n      // Only run on desktop, and only if a panel is active\n      if (!isDesktop() || !activePanelId) return;\n\n      const activePanel = document.getElementById(activePanelId);\n      if (!activePanel) return;\n\n      const isClickInsidePanel = activePanel.contains(e.target);\n      const isClickInsideBar = filterBar.contains(e.target);\n\n      if (!isClickInsidePanel && !isClickInsideBar) {\n        // Clicked outside both the bar and the active panel\n        activePanel.classList.remove("active");\n        activePanel.style.display = "none"; // Explicitly hide\n        activeTabElement?.classList.remove("active");\n        activePanelId = null;\n        activeTabElement = null;\n        document.body.classList.remove("is-filter-active");\n      }\n    });\n\n    // --- Reposition panel on window resize & Mobile cleanup (MODIFIED) ---\n    window.addEventListener("resize", () => {\n      // Only run if a panel is currently open and we are on desktop\n      if (activePanelId && activeTabElement && isDesktop()) {\n        positionPanel(\n          activeTabElement,\n          document.getElementById(activePanelId)\n        );\n      }\n\n      // NEW: If resizing to desktop, close the mobile expanded state\n      if (isDesktop()) {\n        formElement.classList.remove("is-expanded");\n        // Ensure mobile-specific active states are also cleared\n        document.body.classList.remove("is-filter-active");\n      } else {\n        // If resizing to mobile, ensure desktop display none is removed if expanded\n        if (formElement.classList.contains("is-expanded")) {\n          document.querySelectorAll(".filter-panel").forEach((p) => {\n            p.style.display = "";\n          });\n        }\n      }\n    });\n\n    // --- Input listeners for state management and text updates ---\n    formElement.addEventListener("input", updateTabSelections);\n\n    //search button listener\n    // Function to check if any form field has a non-empty/non-default value.\n    // It returns true if a search should be executed, false otherwise.\n    const hasMeaningfulInput = (formData) => {\n      // Define values that should NOT trigger a search (defaults/empties)\n      const defaultValues = ["", "0", "unbekannt", "egal"];\n\n      for (const [key, value] of formData.entries()) {\n        const trimmedValue = String(value).trim().toLowerCase();\n\n        // Ignore known non-input fields like the button name itself if present\n        if (key.startsWith("btn-") || key.startsWith("submit-")) {\n          continue;\n        }\n\n        // Check if the value is NOT one of the defined default/empty states\n        // This is the core logic: if we find *any* non-default value, we execute the search.\n        if (!defaultValues.includes(trimmedValue)) {\n          return true;\n        }\n      }\n\n      // If the loop finishes without finding any meaningful input, don\'t search.\n      return false;\n    };\n\n    formElement.addEventListener("submit", (e) => {\n      e.preventDefault();\n      const formData = new FormData(formElement);\n\n      // 1. Check for meaningful input\n      if (hasMeaningfulInput(formData)) {\n        // 2. ONLY DISPATCH EVENT IF INPUT IS FOUND\n        const filterEvent = new CustomEvent("filter:submit", {\n          detail: { formData: formData },\n        });\n        document.dispatchEvent(filterEvent);\n      } else {\n        // OPTIONAL: Provide feedback to the user\n        console.log("Search blocked: No filters selected.");\n        // You might want to display a message on the UI here, e.g.,\n        // alert("Bitte w\xE4hlen Sie mindestens einen Filter aus.");\n      }\n\n      // 3. Close the filter panel regardless of whether a search ran\n      if (activePanelId) {\n        const activePanel = document.getElementById(activePanelId);\n        activePanel.classList.remove("active");\n        if (isDesktop()) {\n          activePanel.style.display = "none";\n        }\n        activeTabElement?.classList.remove("active");\n        activePanelId = null;\n        activeTabElement = null;\n        document.body.classList.remove("is-filter-active");\n      }\n\n      // Also close mobile expanded state on submit\n      formElement.classList.remove("is-expanded");\n    });\n\n    // Add change listener for Vermarktungsart\n    document.querySelectorAll(\'[name="vermarktungsart"]\').forEach((input) => {\n      input.addEventListener("change", () => {\n        handleVermarktungsartChange();\n        updateTabSelections();\n      });\n    });\n\n    // Add change listeners for all other inputs (needed for updates even if panel is closed)\n    document\n      .querySelectorAll(".filter-panel input, .filter-panel select")\n      .forEach((input) => {\n        input.addEventListener("change", updateTabSelections);\n      });\n\n    // Run initial state setup\n    handleVermarktungsartChange();\n  };\n\n  setupEventListeners();\n  updateTabSelections(); // Initial text update\n});\n})();<\/script>'], ["", '<section id="properties-filter" class="section-properties-filter-form" data-astro-cid-dtgl45ca> <div class="properties-filter-wrapper" data-astro-cid-dtgl45ca> <div id="property-filter-form" class="form-block" data-astro-cid-dtgl45ca> <form id="property-filter-form-element" name="property-filter-form" class="form" data-astro-cid-dtgl45ca> <div id="mobile-summary-bar" class="filter-heading-tab" data-astro-cid-dtgl45ca> <div id="mobile-summary-text" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nAlle Filter Optionen\n</div> <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor" data-astro-cid-dtgl45ca><path d="M440-160q-17 0-28.5-11.5T400-200v-240L168-736q-15-20-4.5-42t36.5-22h560q26 0 36.5 22t-4.5 42L560-440v240q0 17-11.5 28.5T520-160h-80Zm40-308 198-252H282l198 252Zm0 0Z" data-astro-cid-dtgl45ca></path></svg> <!-- Add an icon here if desired, like an arrow down --> </div> <div id="mobile-expanded-content" data-astro-cid-dtgl45ca> <div id="filter-heading-bar" class="filter-heading-bar" data-astro-cid-dtgl45ca> <div class="mobile-close-button-wrapper" data-astro-cid-dtgl45ca> <button id="mobile-close-button" type="button" aria-label="Filter schlie\xDFen" data-astro-cid-dtgl45ca>\n&times;\n</button> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="immobilie" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Immobilie</div> <div id="selection-immobilie" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nAlle Kategorien\n</div> </div> <div id="panel-immobilie" class="filter-panel panel-immobilie" data-astro-cid-dtgl45ca> <div id="filter-vermarktungsart" class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Vermarktungsart</h2> <div class="filter-form-input-wrapper radio-input-group" data-astro-cid-dtgl45ca> <label class="radio-classic-label" data-astro-cid-dtgl45ca> <input type="radio" name="vermarktungsart" value="miete" data-astro-cid-dtgl45ca>Miete\n</label> <label class="radio-classic-label" data-astro-cid-dtgl45ca> <input type="radio" name="vermarktungsart" value="kauf" data-astro-cid-dtgl45ca>Kauf\n</label> </div> </div> <div id="filter-objektart" class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Objektart</h2>  ', ' </div> <a href="#" data-panel="immobilie" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="ort" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Ort</div> <div id="selection-ort" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nAlle Orte\n</div> </div> <div id="panel-ort" class="filter-panel panel-ort" data-astro-cid-dtgl45ca> ', ' <a href="#" data-panel="ort" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="groesse" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Gr\xF6\xDFe</div> <div id="selection-groesse" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nJede Gr\xF6\xDFe\n</div> </div> <div id="panel-groesse" class="filter-panel panel-groesse" data-astro-cid-dtgl45ca> <div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Zimmer</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="zimmer-min" placeholder="Min" type="number" id="filter-zimmer-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="zimmer-max" placeholder="Max" type="number" id="filter-zimmer-max" data-astro-cid-dtgl45ca> </div> </div> <div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Fl\xE4che (m\xB2)</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="flaeche-min" placeholder="Min" type="number" id="filter-flaeche-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="flaeche-max" placeholder="Max" type="number" id="filter-flaeche-max" data-astro-cid-dtgl45ca> </div> </div> <a href="#" data-panel="groesse" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="preis" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Preis</div> <div id="selection-preis" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nJeder Preis\n</div> </div> <div id="panel-preis" class="filter-panel panel-preis" data-astro-cid-dtgl45ca>  <div class="filter-form-group price-group price-group-kauf" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Kaufpreis (\u20AC)</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="preis-kauf-min" placeholder="Min" type="number" id="filter-preis-kauf-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="preis-kauf-max" placeholder="Max" type="number" id="filter-preis-kauf-max" data-astro-cid-dtgl45ca> </div> </div> <div class="filter-form-group price-group price-group-miete" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Miete (\u20AC)</h2> <div class="number-input-wrapper" data-astro-cid-dtgl45ca> <input class="text-field" name="preis-miete-min" placeholder="Min" type="number" id="filter-preis-miete-min" data-astro-cid-dtgl45ca> <div class="input-separator" data-astro-cid-dtgl45ca>bis</div> <input class="text-field" name="preis-miete-max" placeholder="Max" type="number" id="filter-preis-miete-max" data-astro-cid-dtgl45ca> </div> </div> <a href="#" data-panel="preis" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div class="filter-group-mobile-wrapper" data-astro-cid-dtgl45ca> <div data-tab="ausstattung" class="filter-heading-tab tab-container" data-astro-cid-dtgl45ca> <div class="filter-heading-tab-name" data-astro-cid-dtgl45ca>Ausstattung</div> <div id="selection-ausstattung" class="filter-heading-tab-selection" data-astro-cid-dtgl45ca>\nDetails\n</div> </div> <div id="panel-ausstattung" class="filter-panel panel-ausstattung" data-astro-cid-dtgl45ca> <div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading" data-astro-cid-dtgl45ca>Details</h2> <div class="filter-form-input-wrapper checkbox-columns" data-astro-cid-dtgl45ca> <div class="checkbox-column" data-astro-cid-dtgl45ca> ', ' </div> <div class="checkbox-column" data-astro-cid-dtgl45ca> ', ' </div> </div> </div> <a href="#" data-panel="ausstattung" class="reset-button button" data-astro-cid-dtgl45ca>Zur\xFCcksetzen</a> </div> </div> <div id="search-button" class="search-button-wrapper" data-astro-cid-dtgl45ca> <button type="submit" class="custom-submit-button" data-astro-cid-dtgl45ca> ', "\nSuchen\n</button> </div> </div> </div> </form> </div> </div> </section>  <script>(function(){", '\ndocument.addEventListener("DOMContentLoaded", () => {\n  const filterBar = document.getElementById("filter-heading-bar");\n  const formElement = document.getElementById("property-filter-form-element");\n  const mobileSummaryBar = document.getElementById("mobile-summary-bar");\n  const mobileSummaryText = document.getElementById("mobile-summary-text");\n  const mobileCloseButton = document.getElementById("mobile-close-button"); // NEW\n  const priceGroupKauf = document.querySelector(".price-group-kauf");\n  const priceGroupMiete = document.querySelector(".price-group-miete");\n\n  // Define allTabs here for use in updateMobileSummaryText and listeners\n  const tabsContainer = document.getElementById("filter-heading-bar");\n  const allTabs = tabsContainer\n    ? tabsContainer.querySelectorAll(\n      ".filter-heading-tab:not(#mobile-summary-bar)"\n    )\n    : [];\n\n  // Get references to the selection text elements\n  const selectionImmobilie = document.getElementById("selection-immobilie");\n  const selectionOrt = document.getElementById("selection-ort");\n  const selectionGroesse = document.getElementById("selection-groesse");\n  const selectionPreis = document.getElementById("selection-preis");\n  const selectionAusstattung = document.getElementById(\n    "selection-ausstattung"\n  );\n\n  // --- GLOBAL STATE ---\n  let activePanelId = null; // Store ID of currently active panel (e.g., \'panel-immobilie\')\n  let activeTabElement = null; // Store reference to the currently active tab element\n\n  // Safety check\n  if (\n    !filterBar ||\n    !formElement ||\n    !priceGroupKauf ||\n    !priceGroupMiete ||\n    !selectionImmobilie ||\n    !selectionOrt ||\n    !selectionGroesse ||\n    !selectionPreis ||\n    !selectionAusstattung\n  )\n    return;\n\n  // --- Utility Function: Check for Mobile/Desktop View ---\n  const isDesktop = () => window.matchMedia("(min-width: 992px)").matches;\n\n  // --- DYNAMIC POSITIONING LOGIC (DESKTOP ONLY) ---\n  /**\n   * Calculates the position of the selected tab and moves the filter panel directly beneath it.\n   * @param {HTMLElement} targetTab The tab element to align the panel under.\n   * @param {HTMLElement} panelElement The panel element to position.\n   */\n  function positionPanel(targetTab, panelElement) {\n    if (!isDesktop()) return; // Only apply dynamic positioning on desktop\n\n    const filterBarRect = filterBar.getBoundingClientRect();\n    const formRect = formElement.getBoundingClientRect();\n\n    // The newLeft is the distance from the form\'s left edge to the filterBar\'s left edge.\n    const newLeft = filterBarRect.left - formRect.left;\n\n    // The newTop must place the panel at the bottom of the filter bar.\n    const newTop = filterBar.offsetTop + filterBar.offsetHeight + 4; // Add a small gap (4px)\n\n    // Apply the new position\n    panelElement.style.left = \\`\\${newLeft}px\\`;\n    panelElement.style.top = \\`\\${newTop}px\\`;\n  }\n\n  // --- Utility Function: Get Value or Null ---\n  const getInputValue = (name) => {\n    const input = formElement.querySelector(\\`[name="\\${name}"]\\`);\n    // @ts-ignore\n    return input?.value ? input.value : null;\n  };\n\n  // --- Utility Function: Format Price ---\n  const formatPrice = (price) => {\n    if (price === null || isNaN(Number(price))) return "";\n    return new Intl.NumberFormat("de-DE", {\n      maximumFractionDigits: 0,\n    }).format(Number(price));\n  };\n\n  // --- Utility Function: Reset Form Fields ---\n  const resetAllFormFields = () => {\n    formElement.querySelectorAll("input, select").forEach((input) => {\n      // @ts-ignore\n      if (input.type === "checkbox" || input.type === "radio") {\n        // Uncheck all checkboxes and radios\n        input.checked = false;\n      } else if (input.tagName === "SELECT") {\n        input.selectedIndex = 0;\n      } else {\n        // Reset text and number inputs\n        input.value = "";\n      }\n    });\n  };\n\n  // --- MOBILE LOGIC: Update the collapsed summary bar text (MODIFIED) ---\n  function updateMobileSummaryText() {\n    // Check if we are on mobile view\n    if (!mobileSummaryText || isDesktop()) return;\n\n    const selections = Array.from(allTabs)\n      .map((tab) => {\n        const selectionElement = tab.querySelector(\n          ".filter-heading-tab-selection"\n        );\n        return selectionElement ? selectionElement.textContent : "";\n      })\n      .filter(\n        (text) =>\n          text &&\n          text.trim() !== "Alle Kategorien" &&\n          text.trim() !== "Alle Orte" &&\n          text.trim() !== "Jede Gr\xF6\xDFe" &&\n          text.trim() !== "Jeder Preis" &&\n          text.trim() !== "Details"\n      );\n\n    if (selections.length > 0) {\n      mobileSummaryText.textContent = selections.join(", ");\n    } else {\n      mobileSummaryText.textContent = "Alle Filter Optionen";\n    }\n  }\n\n  function closeMobileModal() {\n    if (isDesktop()) return;\n\n    // 1. Collapse the entire menu (modal)\n    formElement.classList.remove("is-expanded");\n    document.body.classList.remove("is-filter-active");\n\n    // 2. Ensure all panels and active states are closed\n    document\n      .querySelectorAll(".filter-panel")\n      .forEach((p) => p.classList.remove("active"));\n    document\n      .querySelectorAll(".filter-heading-tab")\n      .forEach((t) => t.classList.remove("active"));\n\n    activePanelId = null;\n    activeTabElement = null;\n  }\n\n  function handleMobileSummaryClick() {\n    const isExpanded = formElement.classList.contains("is-expanded");\n\n    if (isDesktop()) return;\n\n    if (!isExpanded) {\n      // Step 1: Expand the entire menu\n      formElement.classList.add("is-expanded");\n\n      // Step 2: Automatically open the first panel (\'immobilie\')\n      const firstTab = document.querySelector(\'[data-tab="immobilie"]\');\n      if (firstTab) {\n        // Use a short delay to ensure expansion transition starts before panel opens\n        setTimeout(() => {\n          // Pass true to force the panel to open\n          togglePanel(firstTab, true);\n        }, 50);\n      }\n    } else {\n      // If expanded, clicking the summary bar collapses the filter entirely\n      formElement.classList.remove("is-expanded");\n\n      // Ensure all panels and active states are closed\n      document\n        .querySelectorAll(".filter-panel")\n        .forEach((p) => p.classList.remove("active"));\n      document\n        .querySelectorAll(".filter-heading-tab")\n        .forEach((t) => t.classList.remove("active"));\n\n      activePanelId = null;\n      activeTabElement = null;\n      document.body.classList.remove("is-filter-active");\n    }\n  }\n\n  // --- CORE LOGIC: UPDATE TAB SELECTION TEXTS ---\n  const updateTabSelections = () => {\n    const formData = new FormData(formElement);\n\n    // --- 1. IMMOBILIE (vermarktungsart, objektart) ---\n    const vmArt = formData.get("vermarktungsart");\n    const objArts = formData.getAll("objektart").filter((v) => v.length > 0);\n\n    let immobilietext = "Alle Kategorien";\n    const vmAction = vmArt === "miete" ? "mieten" : "kaufen";\n    const vmType = vmArt === "miete" ? "Mieten" : "Kaufen";\n\n    if (vmArt && objArts.length === 0) {\n      immobilietext = vmType;\n    } else if (vmArt && objArts.length === 1) {\n      immobilietext = \\`\\${objArts[0]} \\${vmAction}\\`;\n    } else if (vmArt && objArts.length > 1) {\n      immobilietext = \\`\\${objArts.length} Objektarten \\${vmAction}\\`;\n    } else if (!vmArt && objArts.length === 1) {\n      immobilietext = objArts[0];\n    } else if (!vmArt && objArts.length > 1) {\n      immobilietext = \\`\\${objArts.length} Objektarten\\`;\n    }\n\n    selectionImmobilie.textContent = immobilietext;\n\n    // --- 2. ORT (lage) ---\n    const selectedLages = formData.getAll("lage").filter((v) => v.length > 0);\n    let ortText = "Alle Orte";\n\n    if (selectedLages.length === 1) {\n      const selectedLage = selectedLages[0];\n      // Note: viennaDistricts is expected to be available in this scope via define:vars\n      // Assuming capitalization is handled externally or not critical here\n      if (\n        Array.isArray(viennaDistricts) &&\n        viennaDistricts.includes(selectedLage)\n      ) {\n        ortText = selectedLage;\n      } else {\n        ortText = selectedLage;\n      }\n    } else if (selectedLages.length > 1) {\n      ortText = \\`\\${selectedLages.length} Orte\\`;\n    }\n\n    selectionOrt.textContent = ortText;\n\n    // --- 3. GR\xD6SSE (zimmer, flaeche) ---\n    let zimmerMin = getInputValue("zimmer-min");\n    let zimmerMax = getInputValue("zimmer-max");\n    let flaecheMin = getInputValue("flaeche-min");\n    let flaecheMax = getInputValue("flaeche-max");\n\n    let zimmerText = "";\n    if (zimmerMin && zimmerMax) {\n      zimmerText = \\`\\${zimmerMin} - \\${zimmerMax} Zimmer\\`;\n    } else if (zimmerMin) {\n      zimmerText = \\`ab \\${zimmerMin} Zimmer\\`;\n    } else if (zimmerMax) {\n      zimmerText = \\`bis \\${zimmerMax} Zimmer\\`;\n    }\n\n    let flaecheText = "";\n    if (flaecheMin && flaecheMax) {\n      flaecheText = \\`\\${flaecheMin} - \\${flaecheMax} m\xB2\\`;\n    } else if (flaecheMin) {\n      flaecheText = \\`ab \\${flaecheMin} m\xB2\\`;\n    } else if (flaecheMax) {\n      flaecheText = \\`bis \\${flaecheMax} m\xB2\\`;\n    }\n\n    let groesseText = "Jede Gr\xF6\xDFe";\n    if (zimmerText && flaecheText) {\n      groesseText = \\`\\${zimmerText}, \\${flaecheText}\\`;\n    } else if (zimmerText) {\n      groesseText = zimmerText;\n    } else if (flaecheText) {\n      groesseText = flaecheText;\n    }\n\n    selectionGroesse.textContent = groesseText;\n\n    // --- 4. PREIS (price-kauf/miete) ---\n    let kaufMin = getInputValue("preis-kauf-min");\n    let kaufMax = getInputValue("preis-kauf-max");\n    let mieteMin = getInputValue("preis-miete-min");\n    let mieteMax = getInputValue("preis-miete-max");\n\n    let kaufRange = "";\n    let mieteRange = "";\n\n    if (kaufMin || kaufMax) {\n      if (kaufMin && kaufMax) {\n        kaufRange = \\`\\${formatPrice(kaufMin)} - \\${formatPrice(kaufMax)} \u20AC\\`;\n      } else if (kaufMin) {\n        kaufRange = \\`ab \\${formatPrice(kaufMin)} \u20AC\\`;\n      } else if (kaufMax) {\n        kaufRange = \\`bis \\${formatPrice(kaufMax)} \u20AC\\`;\n      }\n    }\n\n    if (mieteMin || mieteMax) {\n      if (mieteMin && mieteMax) {\n        mieteRange = \\`\\${formatPrice(mieteMin)} - \\${formatPrice(mieteMax)} \u20AC/Monat\\`;\n      } else if (mieteMin) {\n        mieteRange = \\`ab \\${formatPrice(mieteMin)} \u20AC/Monat\\`;\n      } else if (mieteMax) {\n        mieteRange = \\`bis \\${formatPrice(mieteMax)} \u20AC/Monat\\`;\n      }\n    }\n\n    let preisText = "Jeder Preis";\n\n    if (vmArt === "kauf") {\n      preisText = kaufRange || "Jeder Preis";\n    } else if (vmArt === "miete") {\n      preisText = mieteRange.replace("/Monat", "") || "Jeder Preis";\n    } else {\n      if (kaufRange && mieteRange) {\n        preisText = "Kauf & Miete";\n      } else if (kaufRange) {\n        preisText = kaufRange;\n      } else if (mieteRange) {\n        preisText = mieteRange.replace("/Monat", "");\n      }\n    }\n    selectionPreis.textContent = preisText;\n\n    // --- 5. AUSSTATTUNG (ausstattung) ---\n    const selectedAmenities = formData\n      .getAll("ausstattung")\n      .filter((v) => v.length > 0);\n    let ausstattungText = "Details";\n\n    if (selectedAmenities.length === 1) {\n      // Assuming a capitalize function exists or just use the raw value\n      ausstattungText = selectedAmenities[0]; // Removed capitalize() for safety\n    } else if (selectedAmenities.length > 1) {\n      ausstattungText = \\`\\${selectedAmenities.length} Details\\`;\n    }\n    selectionAusstattung.textContent = ausstattungText;\n\n    // Always update the mobile summary bar after updating individual selections\n    updateMobileSummaryText();\n  };\n\n  // --- Price Group Visibility Logic (Used on init and on \'immobilie\' change) ---\n  function handleVermarktungsartChange() {\n    const vmArt = getInputValue("vermarktungsart");\n\n    // Hide both first\n    priceGroupKauf.classList.add("hidden");\n    priceGroupMiete.classList.add("hidden");\n\n    if (vmArt === "miete") {\n      priceGroupMiete.classList.remove("hidden");\n    } else if (vmArt === "kauf") {\n      priceGroupKauf.classList.remove("hidden");\n    } else {\n      // Show both if nothing is selected (default)\n      priceGroupKauf.classList.remove("hidden");\n      priceGroupMiete.classList.remove("hidden");\n    }\n  }\n\n  // --- CORE LOGIC: TOGGLE PANEL VISIBILITY (MODIFIED) ---\n  /**\n   * Toggles the visibility and active state of a filter tab and its associated panel.\n   * @param {HTMLElement} targetTab The tab element that was clicked.\n   * @param {boolean} [forceOpen=false] If true, forces the panel to open even if it\'s currently inactive.\n   */\n  function togglePanel(targetTab, forceOpen = false) {\n    const tabName = targetTab.getAttribute("data-tab");\n    const panelId = \\`panel-\\${tabName}\\`;\n    const panelElement = document.getElementById(panelId);\n\n    if (!panelElement) return;\n\n    const isActive = targetTab.classList.contains("active");\n    const isMobileView = !isDesktop();\n\n    // 1. Determine if we should OPEN or CLOSE\n    const shouldOpen = forceOpen || !isActive;\n\n    // 2. Close All First\n    document.querySelectorAll(".filter-panel").forEach((p) => {\n      p.classList.remove("active");\n      if (!isMobileView) {\n        // Only manipulate display property on Desktop\n        p.style.display = "none";\n      }\n    });\n    document.querySelectorAll(".filter-heading-tab").forEach((t) => {\n      t.classList.remove("active");\n    });\n\n    // 3. Open or Remain Closed\n    if (shouldOpen) {\n      // Open the new panel\n      targetTab.classList.add("active");\n      panelElement.classList.add("active");\n\n      if (!isMobileView) {\n        // Desktop logic: Show and Position\n        panelElement.style.display = "block";\n        positionPanel(targetTab, panelElement);\n        document.body.classList.add("is-filter-active");\n      }\n\n      activePanelId = panelId;\n      activeTabElement = targetTab;\n    } else {\n      // Panel was active and clicked again -> close it\n      activePanelId = null;\n      activeTabElement = null;\n      document.body.classList.remove("is-filter-active");\n    }\n\n    handleVermarktungsartChange();\n  }\n\n  // --- CORE LOGIC: SETUP EVENT LISTENERS ---\n  const setupEventListeners = () => {\n    // NEW: Attach listener to the mobile summary bar\n    if (mobileSummaryBar) {\n      mobileSummaryBar.addEventListener("click", handleMobileSummaryClick);\n    }\n    if (mobileCloseButton) {\n      mobileCloseButton.addEventListener("click", closeMobileModal);\n    }\n\n    // Listen for tab clicks to toggle panels (MODIFIED)\n    filterBar.addEventListener("click", (e) => {\n      const targetTab = e.target.closest(".tab-container");\n      if (!targetTab) return;\n\n      const isMobileExpanded = formElement.classList.contains("is-expanded");\n\n      if (!isDesktop()) {\n        // On mobile, only allow tab clicks if the menu is expanded\n        if (isMobileExpanded) {\n          togglePanel(targetTab);\n        }\n      } else {\n        // Desktop behavior\n        togglePanel(targetTab);\n      }\n    });\n\n    document.querySelectorAll(".reset-button").forEach((button) => {\n      button.addEventListener("click", (e) => {\n        e.preventDefault();\n\n        resetAllFormFields();\n\n        // Update UI\n        updateTabSelections();\n        handleVermarktungsartChange();\n\n        // Dispatch filter event\n        const formData = new FormData(formElement);\n        const filterEvent = new CustomEvent("filter:submit", {\n          detail: { formData: formData },\n        });\n        document.dispatchEvent(filterEvent);\n      });\n    });\n\n    // --- Global click listener to close panel when clicking outside (Desktop only) ---\n    document.addEventListener("click", (e) => {\n      // Only run on desktop, and only if a panel is active\n      if (!isDesktop() || !activePanelId) return;\n\n      const activePanel = document.getElementById(activePanelId);\n      if (!activePanel) return;\n\n      const isClickInsidePanel = activePanel.contains(e.target);\n      const isClickInsideBar = filterBar.contains(e.target);\n\n      if (!isClickInsidePanel && !isClickInsideBar) {\n        // Clicked outside both the bar and the active panel\n        activePanel.classList.remove("active");\n        activePanel.style.display = "none"; // Explicitly hide\n        activeTabElement?.classList.remove("active");\n        activePanelId = null;\n        activeTabElement = null;\n        document.body.classList.remove("is-filter-active");\n      }\n    });\n\n    // --- Reposition panel on window resize & Mobile cleanup (MODIFIED) ---\n    window.addEventListener("resize", () => {\n      // Only run if a panel is currently open and we are on desktop\n      if (activePanelId && activeTabElement && isDesktop()) {\n        positionPanel(\n          activeTabElement,\n          document.getElementById(activePanelId)\n        );\n      }\n\n      // NEW: If resizing to desktop, close the mobile expanded state\n      if (isDesktop()) {\n        formElement.classList.remove("is-expanded");\n        // Ensure mobile-specific active states are also cleared\n        document.body.classList.remove("is-filter-active");\n      } else {\n        // If resizing to mobile, ensure desktop display none is removed if expanded\n        if (formElement.classList.contains("is-expanded")) {\n          document.querySelectorAll(".filter-panel").forEach((p) => {\n            p.style.display = "";\n          });\n        }\n      }\n    });\n\n    // --- Input listeners for state management and text updates ---\n    formElement.addEventListener("input", updateTabSelections);\n\n    //search button listener\n    // Function to check if any form field has a non-empty/non-default value.\n    // It returns true if a search should be executed, false otherwise.\n    const hasMeaningfulInput = (formData) => {\n      // Define values that should NOT trigger a search (defaults/empties)\n      const defaultValues = ["", "0", "unbekannt", "egal"];\n\n      for (const [key, value] of formData.entries()) {\n        const trimmedValue = String(value).trim().toLowerCase();\n\n        // Ignore known non-input fields like the button name itself if present\n        if (key.startsWith("btn-") || key.startsWith("submit-")) {\n          continue;\n        }\n\n        // Check if the value is NOT one of the defined default/empty states\n        // This is the core logic: if we find *any* non-default value, we execute the search.\n        if (!defaultValues.includes(trimmedValue)) {\n          return true;\n        }\n      }\n\n      // If the loop finishes without finding any meaningful input, don\'t search.\n      return false;\n    };\n\n    formElement.addEventListener("submit", (e) => {\n      e.preventDefault();\n      const formData = new FormData(formElement);\n\n      // 1. Check for meaningful input\n      if (hasMeaningfulInput(formData)) {\n        // 2. ONLY DISPATCH EVENT IF INPUT IS FOUND\n        const filterEvent = new CustomEvent("filter:submit", {\n          detail: { formData: formData },\n        });\n        document.dispatchEvent(filterEvent);\n      } else {\n        // OPTIONAL: Provide feedback to the user\n        console.log("Search blocked: No filters selected.");\n        // You might want to display a message on the UI here, e.g.,\n        // alert("Bitte w\xE4hlen Sie mindestens einen Filter aus.");\n      }\n\n      // 3. Close the filter panel regardless of whether a search ran\n      if (activePanelId) {\n        const activePanel = document.getElementById(activePanelId);\n        activePanel.classList.remove("active");\n        if (isDesktop()) {\n          activePanel.style.display = "none";\n        }\n        activeTabElement?.classList.remove("active");\n        activePanelId = null;\n        activeTabElement = null;\n        document.body.classList.remove("is-filter-active");\n      }\n\n      // Also close mobile expanded state on submit\n      formElement.classList.remove("is-expanded");\n    });\n\n    // Add change listener for Vermarktungsart\n    document.querySelectorAll(\'[name="vermarktungsart"]\').forEach((input) => {\n      input.addEventListener("change", () => {\n        handleVermarktungsartChange();\n        updateTabSelections();\n      });\n    });\n\n    // Add change listeners for all other inputs (needed for updates even if panel is closed)\n    document\n      .querySelectorAll(".filter-panel input, .filter-panel select")\n      .forEach((input) => {\n        input.addEventListener("change", updateTabSelections);\n      });\n\n    // Run initial state setup\n    handleVermarktungsartChange();\n  };\n\n  setupEventListeners();\n  updateTabSelections(); // Initial text update\n});\n})();<\/script>'])), maybeRenderHead(), objektarten.length > 0 ? renderTemplate`<div class="filter-form-input-wrapper checkbox-columns objektart-filter" data-astro-cid-dtgl45ca> ${objektarten.map((type) => renderTemplate`<label class="checkbox-label" data-astro-cid-dtgl45ca> <input type="checkbox" name="objektart"${addAttribute(type, "value")} class="checkbox-input" data-astro-cid-dtgl45ca> <span class="checkbox-text" data-astro-cid-dtgl45ca>${type}</span> </label>`)} </div>` : renderTemplate`<p data-astro-cid-dtgl45ca>Keine Objektarten verfgbar.</p>`, Object.keys(districts).map((region) => renderTemplate`<div class="filter-form-group" data-astro-cid-dtgl45ca> <h2 class="filter-form-heading " data-astro-cid-dtgl45ca>${region}</h2> <div class="filter-form-input-wrapper checkbox-columns" data-astro-cid-dtgl45ca> <div class="checkbox-column" data-astro-cid-dtgl45ca> ${districts[region].slice(0, Math.ceil(districts[region].length / 2)).map((district) => renderTemplate`<label class="checkbox-label" data-astro-cid-dtgl45ca> <input type="checkbox" name="lage"${addAttribute(district, "value")} class="checkbox-input" data-astro-cid-dtgl45ca> <span class="checkbox-text" data-astro-cid-dtgl45ca>${district}</span> </label>`)} </div> <div class="checkbox-column" data-astro-cid-dtgl45ca> ${districts[region].slice(Math.ceil(districts[region].length / 2)).map((district) => renderTemplate`<label class="checkbox-label" data-astro-cid-dtgl45ca> <input type="checkbox" name="lage"${addAttribute(district, "value")} class="checkbox-input" data-astro-cid-dtgl45ca> <span class="checkbox-text" data-astro-cid-dtgl45ca>${district}</span> </label>`)} </div> </div> </div>`), amenities.slice(0, Math.ceil(amenities.length / 2)).map((amenity) => renderTemplate`<label class="checkbox-label" data-astro-cid-dtgl45ca> <input type="checkbox" name="ausstattung"${addAttribute(amenity, "value")} class="checkbox-input" data-astro-cid-dtgl45ca> <span class="checkbox-text" data-astro-cid-dtgl45ca> ${capitalize(amenity)} </span> </label>`), amenities.slice(Math.ceil(amenities.length / 2)).map((amenity) => renderTemplate`<label class="checkbox-label" data-astro-cid-dtgl45ca> <input type="checkbox" name="ausstattung"${addAttribute(amenity, "value")} class="checkbox-input" data-astro-cid-dtgl45ca> <span class="checkbox-text" data-astro-cid-dtgl45ca> ${capitalize(amenity)} </span> </label>`), renderComponent($$result, "Image", $$Image, { "src": SearchIcon, "alt": "Suchen", "width": 24, "height": 24, "class": "search-icon", "data-astro-cid-dtgl45ca": true }), defineScriptVars({ allLocations, viennaDistricts }));
}, "/Users/piasmith-richling/Code/VF Immobilien/astro/src/components/Sections/properties/PropertiesFilterSearch.astro", void 0);

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$PropertiesGrid = createComponent(async ($$result, $$props, $$slots) => {
  const initialPropertiesQuery = `
    *[_type == "property"] | order(title asc) {
      "slug": slug.current,
      title,
     
      "marketingType": marketingType->title, 
      propertyType, // Objektart is a direct string field
     
      "ausstattung": ausstattung[]->title, 
      purchasePrice,
      rentalPrice,
      livingArea,
      rooms, 
     
      "price": select(
        marketingType->title == "Miete" => rentalPrice, 
        marketingType->title == "Kauf" => purchasePrice, 
        true => rentalPrice // Default
      ),
      "imageUrl": mainImage.asset->url,
      "location": coalesce(locationVienna, locationSurrounding) 
    }
`;
  let initialProperties = [];
  try {
    initialProperties = await sanityClient.fetch(
      initialPropertiesQuery
    );
  } catch (error) {
    console.error("Error fetching initial properties:", error);
  }
  const formatDataForClient = (properties) => {
    return properties.map((p) => ({
      slug: p.slug,
      title: p.title,
      location: p.location || "Unbekannt",
      // Use p.livingArea (from GROQ result) -> map to area
      area: p.livingArea || 0,
      // Use p.rooms (from GROQ result) -> map to rooms
      rooms: p.rooms || 0,
      price: p.price || 0,
      // Ensure marketing type is capitalized to match filter logic
      marketingType: p.marketingType || "Kauf",
      propertyType: p.propertyType || "Unbekannt",
      // Objektart
      ausstattung: p.ausstattung || [],
      // Ausstattung (array of strings)
      imageUrl: p.imageUrl || "/assets/placeholder-default.jpg"
    }));
  };
  const propertiesJson = JSON.stringify(formatDataForClient(initialProperties));
  console.log("JSON Data:", propertiesJson);
  return renderTemplate(_a || (_a = __template(["", '<section id="properties-grid-section" class="property-grid-section" data-astro-cid-3v5ibsz3> <div class="padding-section site-container" data-astro-cid-3v5ibsz3> <div id="loading-state-wrapper" data-astro-cid-3v5ibsz3> <p class="loading-state-p" data-astro-cid-3v5ibsz3>Immobilien laden...</p> </div> <div id="property-list-container" class="property-grid-list"', ' data-astro-cid-3v5ibsz3></div> <div id="no-results-message" class="no-results-message" style="display:none;" data-astro-cid-3v5ibsz3>\nEs wurden keine Immobilien gefunden, die Ihren Kriterien entsprechen.\n</div> <div id="pagination-controls" class="pagination-controls" data-astro-cid-3v5ibsz3></div> </div> </section> <script>\ndocument.addEventListener("DOMContentLoaded", () => {\n	const container = document.getElementById("property-list-container");\n	const noResultsMessage = document.getElementById("no-results-message");\n	const paginationControls = document.getElementById("pagination-controls");\n	const skeletonWrapper = document.getElementById("loading-state-wrapper");\n\n	if (!container || !noResultsMessage || !paginationControls) return; // Basic safety check\n\n	// \u{1F4A1} READ ALL DATA FROM ATTRIBUTES\n	const propertiesJsonString = container.getAttribute("data-properties");\n	const LOCATION_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 20">\n    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M15.5 8.334c0 5.833-7.5 10.833-7.5 10.833s-7.5-5-7.5-10.834a7.5 7.5 0 0 1 15 0Z" transform="translate(.5 0.167)"/>\n    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M8 10.834a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" transform="translate(.5 -1.167)"/>\n</svg>`;\n\n	// Standardize width, height, and use currentColor for CSS control\n	const SQM_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M7.44 11.28a.48.48 0 0 1-.48.48H5.04a.48.48 0 0 1 0-.96h1.92a.48.48 0 0 1 .48.48ZM.72 7.44a.48.48 0 0 0 .48-.48V5.04a.48.48 0 1 0-.96 0v1.92c0 .265.215.48.48.48Zm1.92 3.36H1.2V9.36a.48.48 0 1 0-.96 0v1.44c0 .53.43.96.96.96h1.44a.48.48 0 1 0 0-.96Zm9.12-9.6a.96.96 0 0 0-.96-.96H1.2a.952.952 0 0 0-.713.32.952.952 0 0 0-.247.64v1.44a.48.48 0 0 0 .96 0v-.761l8.922 8.921H9.36a.48.48 0 1 0 0 .96h1.44a.955.955 0 0 0 .714-.32.952.952 0 0 0 .246-.64V1.2Z"/></svg>`;\n\n	const ROOM_SVG = `<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 -960 960 960" width="16" fill="currentColor"><path d="M120-120v-80h80v-560q0-33 23.5-56.5T280-840h400q33 0 56.5 23.5T760-760v560h80v80H120Zm560-80v-560H280v560h400ZM560-440q17 0 28.5-11.5T600-480q0-17-11.5-28.5T560-520q-17 0-28.5 11.5T520-480q0 17 11.5 28.5T560-440ZM280-760v560-560Z"/></svg>`;\n\n	const BACK_ARROW_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M10.4 3.4L9 2 2 8l7 6 1.4-1.4L4.8 8z"/></svg>`;\n	const NEXT_ARROW_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M5.6 12.6L7 14l7-6-7-6-1.4 1.4L11.2 8z"/></svg>`;\n\n	let initialPropertiesData = [];\n	try {\n		if (propertiesJsonString) {\n			initialPropertiesData = JSON.parse(propertiesJsonString);\n		}\n	} catch (e) {\n		console.error("Failed to parse initial property data from attribute:", e);\n		// Fallback to empty array\n	}\n\n	// Simple function to format currency\n	const formatPrice = (price) => {\n		return new Intl.NumberFormat("de-DE", {\n			style: "currency",\n			currency: "EUR",\n			maximumFractionDigits: 0,\n		})\n			.format(price)\n			.replace("\u20AC", "")\n			.trim();\n	};\n\n	// Function to render the property card HTML\n	const renderPropertyCard = (property) => {\n		const priceSuffix = property.marketingType === "Miete" ? "/Monat" : "";\n		const formattedPrice = formatPrice(property.price);\n		const propertyPath = "/properties/" + property.slug;\n		return `\n        <a  href=${propertyPath}  class="property-card">\n                        <div class="property-card-wrapper">\n                            <div class="property-card-image-box">\n\n                                <img\n\n                                src="${property.imageUrl}"\n\n                                loading="lazy"\n\n                                alt="${property.title}"\n\n                                class="property-card-image"\n\n                                />\n\n                            </div>\n                            <div class="property-card-info-wrapper">\n                                <div class="property-card-location-wrapper">\n                                   <div class="location-icon-wrapper">${LOCATION_SVG} </div>\n                                    <div class="property-card-address ">${property.location}</div>\n                                </div>\n                                \n                                <h3 class="heading-style-h5 property-card-heading">${property.title}</h3>\n                    \n                                <div class="property-card-icons-wrapper">\n                                    <div class="property-card-icon-text">\n                                        <div class="detail-icon-wrapper">${SQM_SVG} </div>\n                                        <div class="icon-p">${property.area} qm</div>\n                                    </div>\n                                    \n                                    <div class="property-card-icon-text">\n                                        <div class="detail-icon-wrapper">${ROOM_SVG} </div>\n                                        <div class="icon-p">${property.rooms} Zimmer</div>\n                                    </div>\n                                </div>\n                                \n                    \n                                <div class="property-icon-price-wrapper">\n                                    <div class="price-value">\u20AC ${formattedPrice}</div>\n                                    <div class="price-suffix ">${priceSuffix}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </a>\n                `;\n	};\n	// --- PAGINATION CONSTANTS AND STATE ---\n	// \u{1F447}\uFE0F NEW: 5 rows of 4 items = 20 items per page\n	const ITEMS_PER_PAGE = 16;\n	let currentPage = 1;\n	let currentFilteredProperties = []; // Holds the full list after filtering\n\n	// ------------------------------------------------------------------\n	// \u{1F447}\uFE0F NEW: PAGINATION LOGIC\n	// ------------------------------------------------------------------\n\n	const goToPage = (pageNumber, properties) => {\n		const totalPages = Math.ceil(properties.length / ITEMS_PER_PAGE);\n		if (pageNumber < 1 || pageNumber > totalPages) return;\n\n		currentPage = pageNumber;\n		displayPropertiesForCurrentPage(properties);\n		renderPagination(properties);\n	};\n\n	const displayPropertiesForCurrentPage = (properties) => {\n		container.innerHTML = "";\n		if (skeletonWrapper) {\n			skeletonWrapper.style.display = "none";\n		}\n\n		const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n		const endIndex = startIndex + ITEMS_PER_PAGE;\n		const propertiesToDisplay = properties.slice(startIndex, endIndex);\n\n		if (propertiesToDisplay.length > 0) {\n			propertiesToDisplay.forEach((property) => {\n				container.insertAdjacentHTML(\n					"beforeend",\n					renderPropertyCard(property)\n				);\n			});\n			noResultsMessage.style.display = "none";\n			container.style.display = "grid"; // Show the grid\n		} else {\n			// This case shouldn\'t happen if properties.length > 0, but good for safety\n			container.style.display = "none";\n			noResultsMessage.style.display = "block";\n		}\n	};\n\n	const renderPagination = (properties) => {\n		paginationControls.innerHTML = ""; // Clear previous controls\n		const totalItems = properties.length;\n		if (totalItems <= ITEMS_PER_PAGE) return; // No pagination needed\n\n		const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\n		const controlsHTML = [];\n		const roundBtnBaseStyle = `\n        width: 38px;\n        height: 38px;\n        padding: 0;\n        border-radius: 50%;\n		border: solid 1px var(--color-brand-dark-green);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: none; /* Ensure no background by default */\n    `.replace(/\\s+/g, " ");\n\n		// Style for ENABLED round buttons (adds the background color)\n		const enabledArrowStyle = `\n        ${roundBtnBaseStyle}\n        background-color: var(--color-neutral-lightest); /* <-- NEW: Only when enabled */\n    `.replace(/\\s+/g, " ");\n\n		// Style for DISABLED round buttons (no special background)\n		const disabledArrowStyle = `\n        ${roundBtnBaseStyle}\n        opacity: 0.5;\n        cursor: not-allowed;\n    `.replace(/\\s+/g, " ");\n\n		// Style for NON-ACTIVE Page Numbers (Base Reset)\n		const pageNumBaseStyle = `\n        background: none; \n        border: none; \n        outline: none; \n        box-shadow: none; \n        color: var(--color-brand-dark-green);\n        padding: var(--spacing-md);\n        cursor: pointer;\n        font-weight: var(--font-weight-medium);\n        transition: all 0.2s ease;\n    `.replace(/\\s+/g, " ");\n\n		// Style for ACTIVE Page Number (Bolder, Highlighted Circle)\n		const activeStyle = `\n        background: none;\n        color: var(--color-brand-dark-green);\n        font-weight: var(--font-weight-black);\n       border: none;\n        width: 38px;\n        height: 38px;\n        line-height: 38px;\n        text-align: center;\n        padding: 0;\n        display: inline-block;\n    `.replace(/\\s+/g, " ");\n\n		// 1. Back Button\n		const backBtnInlineStyle =\n			currentPage === 1 ? disabledArrowStyle : enabledArrowStyle;\n		controlsHTML.push(`\n            <button class="pagination-btn back-btn ${currentPage === 1 ? "disabled" : ""}" \n			style="${backBtnInlineStyle}"\n                ${currentPage === 1 ? "disabled" : ""}\n                    data-page="${currentPage - 1}">\n                    ${BACK_ARROW_SVG}\n            </button>\n        `);\n\n		// 2. Page Numbers (ADD INLINE STYLES)\n		for (let i = 1; i <= totalPages; i++) {\n			const currentInlineStyle =\n				i === currentPage ? activeStyle : pageNumBaseStyle;\n			const activeClass = i === currentPage ? "active" : "";\n\n			controlsHTML.push(`\n			<button class="pagination-page-num ${activeClass}"\n							style="${currentInlineStyle}"                        \n							data-page="${i}">\n                    ${i}\n                </button>\n            `);\n		}\n\n		// 3. Next Button\n		const nextBtnInlineStyle =\n			currentPage === totalPages ? disabledArrowStyle : enabledArrowStyle;\n		controlsHTML.push(`\n            <button class="pagination-btn next-btn ${currentPage === totalPages ? "disabled" : ""}" \n			style="${nextBtnInlineStyle}"\n                ${currentPage === totalPages ? "disabled" : ""}\n                    data-page="${currentPage + 1}">\n                    ${NEXT_ARROW_SVG}\n            </button>\n        `);\n\n		paginationControls.innerHTML = controlsHTML.join("");\n\n		// Add click listener to the new buttons\n		paginationControls.querySelectorAll("button").forEach((button) => {\n			button.addEventListener("click", (e) => {\n				const page = parseInt(e.currentTarget.getAttribute("data-page"));\n				if (!isNaN(page)) {\n					goToPage(page, properties);\n					// Optional: Scroll to the top of the grid when page changes\n					container.scrollIntoView({ behavior: "smooth" });\n				}\n			});\n		});\n	};\n	// --- Initial Render ---\n	const initialRender = () => {\n		container.innerHTML = ""; // Clear the "Lade Immobilien..." message\n		currentFilteredProperties = initialPropertiesData;\n		currentPage = 1;\n\n		if (currentFilteredProperties && currentFilteredProperties.length > 0) {\n			displayPropertiesForCurrentPage(currentFilteredProperties);\n			renderPagination(currentFilteredProperties);\n		} else {\n			if (skeletonWrapper) {\n				skeletonWrapper.style.display = "none";\n			}\n			container.style.display = "none";\n			noResultsMessage.style.display = "block";\n		}\n	};\n\n	// Execute the initial render\n	initialRender();\n\n	// --- NEW: Central Filtering Function ---\n	const filterProperties = (formData) => {\n		let filtered = initialPropertiesData;\n\n		// Helper to check if a value is set and not empty\n		const isSet = (value) =>\n			value !== null && value !== undefined && value !== "";\n\n		// --- 1. Vermarktungsart & Objektart (IMMO) ---\n		// \'vermarktungsart\' maps to p.marketingType\n		const vmArt = formData.get("vermarktungsart");\n		// \'objektart\' maps to p.propertyType\n		const objArts = formData.getAll("objektart").filter(isSet);\n\n		filtered = filtered.filter((p) => {\n			// Filter by Vermarktungsart (Miete/Kauf)\n			if (isSet(vmArt)) {\n				// Convert form value (\'miete\'/\'kauf\') to data value (\'Miete\'/\'Kauf\')\n				const requiredType = vmArt.charAt(0).toUpperCase() + vmArt.slice(1);\n				if (p.marketingType !== requiredType) {\n					return false;\n				}\n			}\n\n			// Filter by Objektart (propertyType)\n			if (objArts.length > 0) {\n				// Property type must be case-insensitive matched against selected types\n				const propertyTypeLower = (p.propertyType || "").toLowerCase();\n				const requiredTypesLower = objArts.map((t) => t.toLowerCase());\n\n				// Property must match at least one selected type\n				if (!requiredTypesLower.includes(propertyTypeLower)) {\n					return false;\n				}\n			}\n\n			return true;\n		});\n\n		// --- 2. Ort (lage) ---\n		const selectedLages = formData\n			.getAll("lage")\n			.filter(isSet)\n			.map((l) => l.toLowerCase());\n		if (selectedLages.length > 0) {\n			filtered = filtered.filter((p) => {\n				const propertyLocationLower = (p.location || "").toLowerCase();\n				return selectedLages.some((lage) =>\n					propertyLocationLower.includes(lage)\n				);\n			});\n		}\n\n		// --- 3. Gr\xF6\xDFe (zimmer, flaeche) ---\n		const zimmerMin = parseInt(formData.get("zimmer-min")) || 0;\n		const zimmerMax = parseInt(formData.get("zimmer-max")) || Infinity;\n		const flaecheMin = parseInt(formData.get("flaeche-min")) || 0;\n		const flaecheMax = parseInt(formData.get("flaeche-max")) || Infinity;\n\n		const isZimmerFilterActive = zimmerMin > 0 || zimmerMax !== Infinity;\n		const isFlaecheFilterActive = flaecheMin > 0 || flaecheMax !== Infinity;\n\n		filtered = filtered.filter((p) => {\n			let matchesZimmer = true;\n			if (isZimmerFilterActive) {\n				matchesZimmer = p.rooms >= zimmerMin && p.rooms <= zimmerMax;\n			}\n\n			let matchesFlaeche = true;\n			if (isFlaecheFilterActive) {\n				matchesFlaeche = p.area >= flaecheMin && p.area <= flaecheMax;\n			}\n			return matchesZimmer && matchesFlaeche;\n		});\n\n		// --- 4. Preis (kauf/miete) ---\n		const kaufMin = parseFloat(formData.get("preis-kauf-min")) || 0;\n		const kaufMax = parseFloat(formData.get("preis-kauf-max")) || Infinity;\n		const mieteMin = parseFloat(formData.get("preis-miete-min")) || 0;\n		const mieteMax = parseFloat(formData.get("preis-miete-max")) || Infinity;\n\n		const isKaufFilterActive = kaufMin > 0 || kaufMax !== Infinity;\n		const isMieteFilterActive = mieteMin > 0 || mieteMax !== Infinity;\n\n		if (isKaufFilterActive || isMieteFilterActive) {\n			filtered = filtered.filter((p) => {\n				const price = p.price || 0;\n\n				if (p.marketingType === "Kauf") {\n					if (isKaufFilterActive) {\n						return price >= kaufMin && price <= kaufMax;\n					}\n					return true;\n				} else if (p.marketingType === "Miete") {\n					if (isMieteFilterActive) {\n						return price >= mieteMin && price <= mieteMax;\n					}\n					return true;\n				}\n				return true;\n			});\n		}\n\n		// --- 5. Ausstattung (Amenities) ---\n		// \'ausstattung\' form inputs map to p.ausstattung data field\n		const selectedAmenities = formData\n			.getAll("ausstattung")\n			.filter(isSet)\n			.map((a) => a.toLowerCase());\n\n		if (selectedAmenities.length > 0) {\n			filtered = filtered.filter((p) => {\n				// p.ausstattung is now an array of strings (the amenity titles)\n				const propertyFeaturesLower = (p.ausstattung || []).map((f) =>\n					f.toLowerCase()\n				);\n\n				// Property must contain ALL selected amenities (AND logic)\n				return selectedAmenities.every((requiredFeature) =>\n					propertyFeaturesLower.includes(requiredFeature)\n				);\n			});\n			console.log(\n				`After Ausstattung filter: ${filtered.length} properties remaining.`\n			);\n		}\n\n		console.log("Filter Result Count:", filtered.length);\n		return filtered;\n	};\n\n	// --- NEW: Event Listener for Filter Submission from the other component ---\n	document.addEventListener("filter:submit", (event) => {\n		const formData = event.detail.formData;\n		if (formData) {\n			const filteredProperties = filterProperties(formData);\n			window.renderPropertyCards(filteredProperties);\n		}\n	});\n\n	// --- Global function for Filter Form to call after AJAX search ---\n	window.renderPropertyCards = (properties) => {\n		if (skeletonWrapper) {\n			skeletonWrapper.style.display = "none";\n		}\n		currentFilteredProperties = properties;\n		currentPage = 1;\n		container.innerHTML = "";\n		if (properties.length > 0) {\n			displayPropertiesForCurrentPage(properties);\n			renderPagination(properties);\n			noResultsMessage.style.display = "none";\n		} else {\n			container.innerHTML = ""; // Ensure container is empty\n			paginationControls.innerHTML = ""; // Clear pagination\n			container.style.display = "none";\n			noResultsMessage.style.display = "block";\n		}\n	};\n});\n<\/script> '], ["", '<section id="properties-grid-section" class="property-grid-section" data-astro-cid-3v5ibsz3> <div class="padding-section site-container" data-astro-cid-3v5ibsz3> <div id="loading-state-wrapper" data-astro-cid-3v5ibsz3> <p class="loading-state-p" data-astro-cid-3v5ibsz3>Immobilien laden...</p> </div> <div id="property-list-container" class="property-grid-list"', ' data-astro-cid-3v5ibsz3></div> <div id="no-results-message" class="no-results-message" style="display:none;" data-astro-cid-3v5ibsz3>\nEs wurden keine Immobilien gefunden, die Ihren Kriterien entsprechen.\n</div> <div id="pagination-controls" class="pagination-controls" data-astro-cid-3v5ibsz3></div> </div> </section> <script>\ndocument.addEventListener("DOMContentLoaded", () => {\n	const container = document.getElementById("property-list-container");\n	const noResultsMessage = document.getElementById("no-results-message");\n	const paginationControls = document.getElementById("pagination-controls");\n	const skeletonWrapper = document.getElementById("loading-state-wrapper");\n\n	if (!container || !noResultsMessage || !paginationControls) return; // Basic safety check\n\n	// \u{1F4A1} READ ALL DATA FROM ATTRIBUTES\n	const propertiesJsonString = container.getAttribute("data-properties");\n	const LOCATION_SVG = \\`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 20">\n    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M15.5 8.334c0 5.833-7.5 10.833-7.5 10.833s-7.5-5-7.5-10.834a7.5 7.5 0 0 1 15 0Z" transform="translate(.5 0.167)"/>\n    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M8 10.834a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" transform="translate(.5 -1.167)"/>\n</svg>\\`;\n\n	// Standardize width, height, and use currentColor for CSS control\n	const SQM_SVG = \\`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M7.44 11.28a.48.48 0 0 1-.48.48H5.04a.48.48 0 0 1 0-.96h1.92a.48.48 0 0 1 .48.48ZM.72 7.44a.48.48 0 0 0 .48-.48V5.04a.48.48 0 1 0-.96 0v1.92c0 .265.215.48.48.48Zm1.92 3.36H1.2V9.36a.48.48 0 1 0-.96 0v1.44c0 .53.43.96.96.96h1.44a.48.48 0 1 0 0-.96Zm9.12-9.6a.96.96 0 0 0-.96-.96H1.2a.952.952 0 0 0-.713.32.952.952 0 0 0-.247.64v1.44a.48.48 0 0 0 .96 0v-.761l8.922 8.921H9.36a.48.48 0 1 0 0 .96h1.44a.955.955 0 0 0 .714-.32.952.952 0 0 0 .246-.64V1.2Z"/></svg>\\`;\n\n	const ROOM_SVG = \\`<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 -960 960 960" width="16" fill="currentColor"><path d="M120-120v-80h80v-560q0-33 23.5-56.5T280-840h400q33 0 56.5 23.5T760-760v560h80v80H120Zm560-80v-560H280v560h400ZM560-440q17 0 28.5-11.5T600-480q0-17-11.5-28.5T560-520q-17 0-28.5 11.5T520-480q0 17 11.5 28.5T560-440ZM280-760v560-560Z"/></svg>\\`;\n\n	const BACK_ARROW_SVG = \\`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M10.4 3.4L9 2 2 8l7 6 1.4-1.4L4.8 8z"/></svg>\\`;\n	const NEXT_ARROW_SVG = \\`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M5.6 12.6L7 14l7-6-7-6-1.4 1.4L11.2 8z"/></svg>\\`;\n\n	let initialPropertiesData = [];\n	try {\n		if (propertiesJsonString) {\n			initialPropertiesData = JSON.parse(propertiesJsonString);\n		}\n	} catch (e) {\n		console.error("Failed to parse initial property data from attribute:", e);\n		// Fallback to empty array\n	}\n\n	// Simple function to format currency\n	const formatPrice = (price) => {\n		return new Intl.NumberFormat("de-DE", {\n			style: "currency",\n			currency: "EUR",\n			maximumFractionDigits: 0,\n		})\n			.format(price)\n			.replace("\u20AC", "")\n			.trim();\n	};\n\n	// Function to render the property card HTML\n	const renderPropertyCard = (property) => {\n		const priceSuffix = property.marketingType === "Miete" ? "/Monat" : "";\n		const formattedPrice = formatPrice(property.price);\n		const propertyPath = "/properties/" + property.slug;\n		return \\`\n        <a  href=\\${propertyPath}  class="property-card">\n                        <div class="property-card-wrapper">\n                            <div class="property-card-image-box">\n\n                                <img\n\n                                src="\\${property.imageUrl}"\n\n                                loading="lazy"\n\n                                alt="\\${property.title}"\n\n                                class="property-card-image"\n\n                                />\n\n                            </div>\n                            <div class="property-card-info-wrapper">\n                                <div class="property-card-location-wrapper">\n                                   <div class="location-icon-wrapper">\\${LOCATION_SVG} </div>\n                                    <div class="property-card-address ">\\${property.location}</div>\n                                </div>\n                                \n                                <h3 class="heading-style-h5 property-card-heading">\\${property.title}</h3>\n                    \n                                <div class="property-card-icons-wrapper">\n                                    <div class="property-card-icon-text">\n                                        <div class="detail-icon-wrapper">\\${SQM_SVG} </div>\n                                        <div class="icon-p">\\${property.area} qm</div>\n                                    </div>\n                                    \n                                    <div class="property-card-icon-text">\n                                        <div class="detail-icon-wrapper">\\${ROOM_SVG} </div>\n                                        <div class="icon-p">\\${property.rooms} Zimmer</div>\n                                    </div>\n                                </div>\n                                \n                    \n                                <div class="property-icon-price-wrapper">\n                                    <div class="price-value">\u20AC \\${formattedPrice}</div>\n                                    <div class="price-suffix ">\\${priceSuffix}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </a>\n                \\`;\n	};\n	// --- PAGINATION CONSTANTS AND STATE ---\n	// \u{1F447}\uFE0F NEW: 5 rows of 4 items = 20 items per page\n	const ITEMS_PER_PAGE = 16;\n	let currentPage = 1;\n	let currentFilteredProperties = []; // Holds the full list after filtering\n\n	// ------------------------------------------------------------------\n	// \u{1F447}\uFE0F NEW: PAGINATION LOGIC\n	// ------------------------------------------------------------------\n\n	const goToPage = (pageNumber, properties) => {\n		const totalPages = Math.ceil(properties.length / ITEMS_PER_PAGE);\n		if (pageNumber < 1 || pageNumber > totalPages) return;\n\n		currentPage = pageNumber;\n		displayPropertiesForCurrentPage(properties);\n		renderPagination(properties);\n	};\n\n	const displayPropertiesForCurrentPage = (properties) => {\n		container.innerHTML = "";\n		if (skeletonWrapper) {\n			skeletonWrapper.style.display = "none";\n		}\n\n		const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n		const endIndex = startIndex + ITEMS_PER_PAGE;\n		const propertiesToDisplay = properties.slice(startIndex, endIndex);\n\n		if (propertiesToDisplay.length > 0) {\n			propertiesToDisplay.forEach((property) => {\n				container.insertAdjacentHTML(\n					"beforeend",\n					renderPropertyCard(property)\n				);\n			});\n			noResultsMessage.style.display = "none";\n			container.style.display = "grid"; // Show the grid\n		} else {\n			// This case shouldn\'t happen if properties.length > 0, but good for safety\n			container.style.display = "none";\n			noResultsMessage.style.display = "block";\n		}\n	};\n\n	const renderPagination = (properties) => {\n		paginationControls.innerHTML = ""; // Clear previous controls\n		const totalItems = properties.length;\n		if (totalItems <= ITEMS_PER_PAGE) return; // No pagination needed\n\n		const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\n		const controlsHTML = [];\n		const roundBtnBaseStyle = \\`\n        width: 38px;\n        height: 38px;\n        padding: 0;\n        border-radius: 50%;\n		border: solid 1px var(--color-brand-dark-green);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: none; /* Ensure no background by default */\n    \\`.replace(/\\\\s+/g, " ");\n\n		// Style for ENABLED round buttons (adds the background color)\n		const enabledArrowStyle = \\`\n        \\${roundBtnBaseStyle}\n        background-color: var(--color-neutral-lightest); /* <-- NEW: Only when enabled */\n    \\`.replace(/\\\\s+/g, " ");\n\n		// Style for DISABLED round buttons (no special background)\n		const disabledArrowStyle = \\`\n        \\${roundBtnBaseStyle}\n        opacity: 0.5;\n        cursor: not-allowed;\n    \\`.replace(/\\\\s+/g, " ");\n\n		// Style for NON-ACTIVE Page Numbers (Base Reset)\n		const pageNumBaseStyle = \\`\n        background: none; \n        border: none; \n        outline: none; \n        box-shadow: none; \n        color: var(--color-brand-dark-green);\n        padding: var(--spacing-md);\n        cursor: pointer;\n        font-weight: var(--font-weight-medium);\n        transition: all 0.2s ease;\n    \\`.replace(/\\\\s+/g, " ");\n\n		// Style for ACTIVE Page Number (Bolder, Highlighted Circle)\n		const activeStyle = \\`\n        background: none;\n        color: var(--color-brand-dark-green);\n        font-weight: var(--font-weight-black);\n       border: none;\n        width: 38px;\n        height: 38px;\n        line-height: 38px;\n        text-align: center;\n        padding: 0;\n        display: inline-block;\n    \\`.replace(/\\\\s+/g, " ");\n\n		// 1. Back Button\n		const backBtnInlineStyle =\n			currentPage === 1 ? disabledArrowStyle : enabledArrowStyle;\n		controlsHTML.push(\\`\n            <button class="pagination-btn back-btn \\${currentPage === 1 ? "disabled" : ""}" \n			style="\\${backBtnInlineStyle}"\n                \\${currentPage === 1 ? "disabled" : ""}\n                    data-page="\\${currentPage - 1}">\n                    \\${BACK_ARROW_SVG}\n            </button>\n        \\`);\n\n		// 2. Page Numbers (ADD INLINE STYLES)\n		for (let i = 1; i <= totalPages; i++) {\n			const currentInlineStyle =\n				i === currentPage ? activeStyle : pageNumBaseStyle;\n			const activeClass = i === currentPage ? "active" : "";\n\n			controlsHTML.push(\\`\n			<button class="pagination-page-num \\${activeClass}"\n							style="\\${currentInlineStyle}"                        \n							data-page="\\${i}">\n                    \\${i}\n                </button>\n            \\`);\n		}\n\n		// 3. Next Button\n		const nextBtnInlineStyle =\n			currentPage === totalPages ? disabledArrowStyle : enabledArrowStyle;\n		controlsHTML.push(\\`\n            <button class="pagination-btn next-btn \\${currentPage === totalPages ? "disabled" : ""}" \n			style="\\${nextBtnInlineStyle}"\n                \\${currentPage === totalPages ? "disabled" : ""}\n                    data-page="\\${currentPage + 1}">\n                    \\${NEXT_ARROW_SVG}\n            </button>\n        \\`);\n\n		paginationControls.innerHTML = controlsHTML.join("");\n\n		// Add click listener to the new buttons\n		paginationControls.querySelectorAll("button").forEach((button) => {\n			button.addEventListener("click", (e) => {\n				const page = parseInt(e.currentTarget.getAttribute("data-page"));\n				if (!isNaN(page)) {\n					goToPage(page, properties);\n					// Optional: Scroll to the top of the grid when page changes\n					container.scrollIntoView({ behavior: "smooth" });\n				}\n			});\n		});\n	};\n	// --- Initial Render ---\n	const initialRender = () => {\n		container.innerHTML = ""; // Clear the "Lade Immobilien..." message\n		currentFilteredProperties = initialPropertiesData;\n		currentPage = 1;\n\n		if (currentFilteredProperties && currentFilteredProperties.length > 0) {\n			displayPropertiesForCurrentPage(currentFilteredProperties);\n			renderPagination(currentFilteredProperties);\n		} else {\n			if (skeletonWrapper) {\n				skeletonWrapper.style.display = "none";\n			}\n			container.style.display = "none";\n			noResultsMessage.style.display = "block";\n		}\n	};\n\n	// Execute the initial render\n	initialRender();\n\n	// --- NEW: Central Filtering Function ---\n	const filterProperties = (formData) => {\n		let filtered = initialPropertiesData;\n\n		// Helper to check if a value is set and not empty\n		const isSet = (value) =>\n			value !== null && value !== undefined && value !== "";\n\n		// --- 1. Vermarktungsart & Objektart (IMMO) ---\n		// \'vermarktungsart\' maps to p.marketingType\n		const vmArt = formData.get("vermarktungsart");\n		// \'objektart\' maps to p.propertyType\n		const objArts = formData.getAll("objektart").filter(isSet);\n\n		filtered = filtered.filter((p) => {\n			// Filter by Vermarktungsart (Miete/Kauf)\n			if (isSet(vmArt)) {\n				// Convert form value (\'miete\'/\'kauf\') to data value (\'Miete\'/\'Kauf\')\n				const requiredType = vmArt.charAt(0).toUpperCase() + vmArt.slice(1);\n				if (p.marketingType !== requiredType) {\n					return false;\n				}\n			}\n\n			// Filter by Objektart (propertyType)\n			if (objArts.length > 0) {\n				// Property type must be case-insensitive matched against selected types\n				const propertyTypeLower = (p.propertyType || "").toLowerCase();\n				const requiredTypesLower = objArts.map((t) => t.toLowerCase());\n\n				// Property must match at least one selected type\n				if (!requiredTypesLower.includes(propertyTypeLower)) {\n					return false;\n				}\n			}\n\n			return true;\n		});\n\n		// --- 2. Ort (lage) ---\n		const selectedLages = formData\n			.getAll("lage")\n			.filter(isSet)\n			.map((l) => l.toLowerCase());\n		if (selectedLages.length > 0) {\n			filtered = filtered.filter((p) => {\n				const propertyLocationLower = (p.location || "").toLowerCase();\n				return selectedLages.some((lage) =>\n					propertyLocationLower.includes(lage)\n				);\n			});\n		}\n\n		// --- 3. Gr\xF6\xDFe (zimmer, flaeche) ---\n		const zimmerMin = parseInt(formData.get("zimmer-min")) || 0;\n		const zimmerMax = parseInt(formData.get("zimmer-max")) || Infinity;\n		const flaecheMin = parseInt(formData.get("flaeche-min")) || 0;\n		const flaecheMax = parseInt(formData.get("flaeche-max")) || Infinity;\n\n		const isZimmerFilterActive = zimmerMin > 0 || zimmerMax !== Infinity;\n		const isFlaecheFilterActive = flaecheMin > 0 || flaecheMax !== Infinity;\n\n		filtered = filtered.filter((p) => {\n			let matchesZimmer = true;\n			if (isZimmerFilterActive) {\n				matchesZimmer = p.rooms >= zimmerMin && p.rooms <= zimmerMax;\n			}\n\n			let matchesFlaeche = true;\n			if (isFlaecheFilterActive) {\n				matchesFlaeche = p.area >= flaecheMin && p.area <= flaecheMax;\n			}\n			return matchesZimmer && matchesFlaeche;\n		});\n\n		// --- 4. Preis (kauf/miete) ---\n		const kaufMin = parseFloat(formData.get("preis-kauf-min")) || 0;\n		const kaufMax = parseFloat(formData.get("preis-kauf-max")) || Infinity;\n		const mieteMin = parseFloat(formData.get("preis-miete-min")) || 0;\n		const mieteMax = parseFloat(formData.get("preis-miete-max")) || Infinity;\n\n		const isKaufFilterActive = kaufMin > 0 || kaufMax !== Infinity;\n		const isMieteFilterActive = mieteMin > 0 || mieteMax !== Infinity;\n\n		if (isKaufFilterActive || isMieteFilterActive) {\n			filtered = filtered.filter((p) => {\n				const price = p.price || 0;\n\n				if (p.marketingType === "Kauf") {\n					if (isKaufFilterActive) {\n						return price >= kaufMin && price <= kaufMax;\n					}\n					return true;\n				} else if (p.marketingType === "Miete") {\n					if (isMieteFilterActive) {\n						return price >= mieteMin && price <= mieteMax;\n					}\n					return true;\n				}\n				return true;\n			});\n		}\n\n		// --- 5. Ausstattung (Amenities) ---\n		// \'ausstattung\' form inputs map to p.ausstattung data field\n		const selectedAmenities = formData\n			.getAll("ausstattung")\n			.filter(isSet)\n			.map((a) => a.toLowerCase());\n\n		if (selectedAmenities.length > 0) {\n			filtered = filtered.filter((p) => {\n				// p.ausstattung is now an array of strings (the amenity titles)\n				const propertyFeaturesLower = (p.ausstattung || []).map((f) =>\n					f.toLowerCase()\n				);\n\n				// Property must contain ALL selected amenities (AND logic)\n				return selectedAmenities.every((requiredFeature) =>\n					propertyFeaturesLower.includes(requiredFeature)\n				);\n			});\n			console.log(\n				\\`After Ausstattung filter: \\${filtered.length} properties remaining.\\`\n			);\n		}\n\n		console.log("Filter Result Count:", filtered.length);\n		return filtered;\n	};\n\n	// --- NEW: Event Listener for Filter Submission from the other component ---\n	document.addEventListener("filter:submit", (event) => {\n		const formData = event.detail.formData;\n		if (formData) {\n			const filteredProperties = filterProperties(formData);\n			window.renderPropertyCards(filteredProperties);\n		}\n	});\n\n	// --- Global function for Filter Form to call after AJAX search ---\n	window.renderPropertyCards = (properties) => {\n		if (skeletonWrapper) {\n			skeletonWrapper.style.display = "none";\n		}\n		currentFilteredProperties = properties;\n		currentPage = 1;\n		container.innerHTML = "";\n		if (properties.length > 0) {\n			displayPropertiesForCurrentPage(properties);\n			renderPagination(properties);\n			noResultsMessage.style.display = "none";\n		} else {\n			container.innerHTML = ""; // Ensure container is empty\n			paginationControls.innerHTML = ""; // Clear pagination\n			container.style.display = "none";\n			noResultsMessage.style.display = "block";\n		}\n	};\n});\n<\/script> '])), maybeRenderHead(), addAttribute(propertiesJson, "data-properties"));
}, "/Users/piasmith-richling/Code/VF Immobilien/astro/src/components/Sections/properties/PropertiesGrid.astro", void 0);

const propertiesHero = new Proxy({"src":"/_astro/properties-hero.Ba3cIf1k.jpg","width":1667,"height":2500,"format":"jpg"}, {
						get(target, name, receiver) {
							if (name === 'clone') {
								return structuredClone(target);
							}
							if (name === 'fsPath') {
								return "/Users/piasmith-richling/Code/VF Immobilien/astro/src/assets/images/properties-hero.jpg";
							}
							
							return target[name];
						}
					});

const $$PropertiesHero = createComponent(($$result, $$props, $$slots) => {
  return renderTemplate`${maybeRenderHead()}<section id="properties-hero" class="properties-hero" data-astro-cid-vg7jilpj> <div class="site-container hero-grid-content padding-section" data-astro-cid-vg7jilpj> <div class="container-align-left" data-astro-cid-vg7jilpj> ${renderComponent($$result, "HeroHeader", $$HeroHeader, { "header": "Immobiliensuche", "headerColor": "var(--color-brand-dark-green)", "data-astro-cid-vg7jilpj": true })} </div> ${renderComponent($$result, "Image", $$Image, { "src": propertiesHero, "alt": "brown wooden door", "class": "angled-image angled-image-mobile-show", "loading": "eager", "widths": [450, 600, 992, 1200, 1667], "sizes": "(max-width: 991px) 100vw, 28vw", "width": 1667, "height": 2500, "data-astro-cid-vg7jilpj": true })} </div> </section> `;
}, "/Users/piasmith-richling/Code/VF Immobilien/astro/src/components/Sections/properties/PropertiesHero.astro", void 0);

const $$PropertySearch = createComponent(($$result, $$props, $$slots) => {
  return renderTemplate`${renderComponent($$result, "MainLayout", $$MainLayout, {}, { "default": ($$result2) => renderTemplate` ${renderComponent($$result2, "PropertiesHero", $$PropertiesHero, {})} ${renderComponent($$result2, "PropertiesFilterSearch", $$PropertiesFilterSearch, {})} ${maybeRenderHead()}<div class="content-to-blur"> ${renderComponent($$result2, "PropertiesGrid", $$PropertiesGrid, {})} </div> ` })}`;
}, "/Users/piasmith-richling/Code/VF Immobilien/astro/src/pages/properties/propertySearch.astro", void 0);

const $$file = "/Users/piasmith-richling/Code/VF Immobilien/astro/src/pages/properties/propertySearch.astro";
const $$url = "/properties/propertySearch";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$PropertySearch,
  file: $$file,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };

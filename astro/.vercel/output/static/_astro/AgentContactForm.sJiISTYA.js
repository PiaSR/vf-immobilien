import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.Cd_vQiNd.js";const k="agent-form-success",E="agent-form-error",l={firstName:"Ihr Name ist erforderlich.",email:{required:"E-Mail-Adresse ist erforderlich.",invalid:"Bitte geben Sie eine gültige E-Mail-Adresse ein (z.B. name@domain.at)."},phone:{required:"Telefonnummer ist erforderlich.",invalid:"Die Telefonnummer darf nur Ziffern und übliche Zeichen (+, -, Klammern) enthalten."},message:"Eine Nachricht ist erforderlich.",tandCs:"Sie müssen den AGBs und Datenschutzbestimmungen zustimmen."},I=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),F=i=>/^[0-9\s\-\+\(\)]+$/.test(i),D=({property:i={}})=>{const[n,p]=o.useState({firstName:"",email:"",phone:"",message:"Ich interessiere mich für dieses Objekt.",tandCs:!1}),[r,f]=o.useState({}),[g,x]=o.useState(!1),[b,d]=o.useState("idle"),[j,u]=o.useState(null),v="/api/contactFormSend",m=t=>{const{name:s,value:a,type:c}=t.target,N=c==="checkbox";p(h=>({...h,[s]:N?t.target.checked:a})),r[s]&&f(h=>{const y={...h};return delete y[s],y})},S=o.useCallback(t=>{const s={};let a=!0;return t.firstName.trim()||(s.firstName=l.firstName,a=!1),t.email.trim()?I(t.email.trim())||(s.email=l.email.invalid,a=!1):(s.email=l.email.required,a=!1),t.phone.trim()?F(t.phone.trim())||(s.phone=l.phone.invalid,a=!1):(s.phone=l.phone.required,a=!1),t.message.trim()||(s.message=l.message,a=!1),t.tandCs||(s.tandCs=l.tandCs,a=!1),f(s),a},[]),C=async t=>{if(t.preventDefault(),d("idle"),u(null),!S(n)){const s=Object.keys(r)[0];document.getElementById(`agent-${s}`)?.focus();return}x(!0);try{const s=new URLSearchParams;s.append("first-name",n.firstName),s.append("email",n.email),s.append("phone",n.phone),s.append("message",n.message),s.append("TandCs",String(n.tandCs)),s.append("property-id",i.id??""),s.append("property-title",i.title??""),s.append("property-address",i.address??""),s.append("context","Sidebar Agent Card");const a=await fetch(v,{method:"POST",body:s.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(a.ok)d("success"),p({firstName:"",email:"",phone:"",message:"Ich interessiere mich für dieses Objekt.",tandCs:!1});else{let c=`Status ${a.status}`;a.headers.get("content-type")?.includes("application/json")&&(c=(await a.json()).error||`Serverfehler (Status: ${a.status})`),u(c),d("error")}}catch(s){u(`Netzwerkfehler: ${s.message}`),d("error")}finally{x(!1)}};return e.jsxs("form",{id:"agent-contact-form",name:"agent-contact-form","data-name":"agent contact form",onSubmit:C,noValidate:!0,children:[e.jsx("input",{type:"hidden",name:"property-id",value:i.id??""}),e.jsx("input",{type:"hidden",name:"property-title",value:i.title??""}),e.jsx("input",{type:"hidden",name:"property-address",value:i.address??""}),e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{htmlFor:"agent-first-name",className:"visually-hidden",children:"Ihr Name"}),e.jsx("input",{className:`form-input ${r.firstName?"error":""}`,name:"firstName",placeholder:"Ihr Name",type:"text",id:"agent-first-name",value:n.firstName,onChange:m,required:!0}),e.jsx("span",{id:"error-agent-first-name",className:"input-error-message",style:{display:r.firstName?"block":"none"},children:r.firstName})]}),e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{htmlFor:"agent-email-input",className:"visually-hidden",children:"Ihre Email"}),e.jsx("input",{className:`form-input ${r.email?"error":""}`,name:"email",placeholder:"Ihre Email",type:"email",id:"agent-email-input",value:n.email,onChange:m,required:!0}),e.jsx("span",{id:"error-agent-email",className:"input-error-message",style:{display:r.email?"block":"none"},children:r.email})]}),e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{htmlFor:"agent-phone-input",className:"visually-hidden",children:"Telefonnummer"}),e.jsx("input",{className:`form-input ${r.phone?"error":""}`,name:"phone",placeholder:"Ihre Telefonnummer",type:"tel",id:"agent-phone-input",value:n.phone,onChange:m,required:!0}),e.jsx("span",{id:"error-agent-phone",className:"input-error-message",style:{display:r.phone?"block":"none"},children:r.phone})]}),e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{htmlFor:"agent-message",className:"visually-hidden",children:"Ihre Nachricht"}),e.jsx("textarea",{id:"agent-message",name:"message",placeholder:"Ich interessiere mich für dieses Objekt...",className:`form-textarea ${r.message?"error":""}`,value:n.message,onChange:m,required:!0}),e.jsx("span",{id:"error-agent-message",className:"input-error-message",style:{display:r.message?"block":"none"},children:r.message})]}),e.jsxs("label",{className:"form-checkbox-label",htmlFor:"agent-TandCs",children:[e.jsx("input",{type:"checkbox",name:"tandCs",id:"agent-TandCs",checked:n.tandCs,onChange:m,required:!0}),e.jsx("span",{className:"checkbox-custom-indicator"}),e.jsxs("span",{className:"checkbox-text",children:["Ich habe die ",e.jsx("a",{href:"/agb",children:"AGB"})," und"," ",e.jsx("a",{href:"/datenschutz",children:"Datenschutzbestimmungen"})," gelesen und erkläre mich damit einverstanden."]})]}),e.jsx("div",{className:"checkbox-error-wrapper",children:e.jsx("span",{id:"error-agent-TandCs",className:"input-error-message",style:{display:r.tandCs?"block":"none"},children:r.tandCs})}),e.jsx("div",{className:"padding-bottom padding-small"}),e.jsx("button",{type:"submit",className:"button-element button-green button-small",disabled:g,children:g?"Anfrage senden...":"Anfrage senden"}),e.jsx("div",{id:k,className:"form-success-message is-visible",style:{display:b==="success"?"block":"none"},children:e.jsx("div",{children:"Danke für Ihre Anfrage! Wir werden uns bald bei Ihnen melden."})}),e.jsx("div",{id:E,className:"form-error-message is-visible",style:{display:b==="error"?"block":"none"},children:e.jsxs("div",{children:["Beim Absenden des Formulars ist ein Fehler aufgetreten. Bitte versuchen Sie es erneut.",j&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Fehler-Details:"})," ",j]})]})})]})};export{D as default};

---
// src/layouts/MainLayout.astro
import Navbar from "../components/Layouts/Navbar.astro";
import Footer from "../components/Layouts/Footer.astro";
import "../styles/global.css";
import "../styles/fonts.css";

const {
  title = "VF Immobilien |  Verwaltung, gebaut auf Vertrauen.",
  description = "VF Immobilien | Verwaltung, gebaut auf Vertrauen.", // Add a default for non-property pages
  ogImage = "/astro/src/assets/images/default-share-image-min.png",
  ogTitle = title,
} = Astro.props;
---

<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <!-- {
      criticalCssContent && (
        <style
          id="critical-styles"
          dangerouslySetInnerHTML={{ __html: criticalCssContent }}
        />
      )
    } -->

    <script is:inline>
      // Function to find all automatically injected CSS links and apply deferral
      // We wait for the browser to parse the HTML and find the link tags that Astro injected.
      function deferStylesheets() {
        document.querySelectorAll('link[rel="stylesheet"]').forEach((link) => {
          //     // Skip if already deferred or if it's not a hashed Astro asset link
          if (
            link.href &&
            link.href.includes("/_astro/") &&
            link.media !== "print"
          ) {
            link.media = "print";
            link.onload = function () {
              this.media = "all";
              this.onload = null; // Clean up memory
            };
          }
        });
      }

      // Attempt to run the deferral script as early as possible
      document.addEventListener("DOMContentLoaded", deferStylesheets);
      // Fallback for full page load
      window.addEventListener("load", deferStylesheets);
    </script>
    <noscript> </noscript>
    <link
      rel="preload"
      href="/astro/public/logos/Viki-new-logo-only-green-1.svg"
      as="image"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/astro/public/logos/Viki-new-logo-only-green-1.svg"
    />

    <title>{title}</title>
    <script
      defer
      id="Cookiebot"
      src="https://consent.cookiebot.com/uc.js"
      data-cbid="dc9e07d5-dc72-477b-ab85-798ff7e1ee18"
      data-blockingmode="auto"
      type="text/javascript"></script>
    <meta name="description" content={description} />

    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content={ogImage} />
    <meta property="og:url" content={Astro.url.href} />
  </head>

  <body>
    <Navbar />
    <main>
      <slot />
    </main>
    <Footer />

    <script is:inline>
      // Animation Observer Script (moved outside the non-existent loadFullCSS)
      document.addEventListener("DOMContentLoaded", () => {
        const sectionsToAnimate =
          document.querySelectorAll(".slide-in-section");

        const observerOptions = {
          root: null,
          rootMargin: "0px",
          threshold: 0.1,
        };

        const observerCallback = (entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
              observer.unobserve(entry.target);
            }
          });
        };

        if (sectionsToAnimate.length > 0) {
          const sectionObserver = new IntersectionObserver(
            observerCallback,
            observerOptions
          );

          sectionsToAnimate.forEach((section) => {
            sectionObserver.observe(section);
          });
        }
      });
    </script>
  </body>
</html>

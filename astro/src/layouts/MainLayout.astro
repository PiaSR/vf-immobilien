---
// src/layouts/MainLayout.astro
import Navbar from "../components/Layouts/Navbar.astro";
import Footer from "../components/Layouts/Footer.astro";
import "../styles/global.css";
import "../styles/fonts.css";

const {
  title,
  description = "VF Immobilien | Verwaltung, gebaut auf Vertrauen.", // Add a default for non-property pages
  ogImage = "/astro/src/assets/images/default-share-image-min.png",
  ogTitle = title,
} = Astro.props;

// --- CRITICAL CSS LOGIC ---
// Define the absolute path to your built critical CSS file
// process.cwd() refers to your project root (./astro)
const CRITICAL_CSS_PATH = path.join(
  process.cwd(),
  "dist",
  "client",
  "critical.css"
);

let criticalCssContent = "";
// Only attempt to read the file during production build
if (import.meta.env.PROD) {
  try {
    // Read the file content synchronously at build time
    criticalCssContent = fs.readFileSync(CRITICAL_CSS_PATH, "utf-8");
  } catch (error) {
    // Log a warning if the file isn't found (e.g., if postbuild script failed)
    console.warn(
      "CRITICAL CSS WARNING: Could not read critical.css. Full CSS will load render-blocking.",
      error.message
    );
  }
}
// --- END CRITICAL CSS LOGIC ---
---

<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    {
      criticalCssContent && (
        <style
          id="critical-styles"
          dangerouslySetInnerHTML={{ __html: criticalCssContent }}
        />
      )
    }
    <link
      rel="stylesheet"
      href="/src/styles/global.css"
      media="print"
      onload="
      this.media = 'all'
"
    />
    <noscript>
      <link rel="stylesheet" href="/src/styles/global.css" />
    </noscript>
    <link
      rel="preload"
      href="/astro/public/logos/Viki-new-logo-only-green-1.svg"
      as="image"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/astro/public/logos/Viki-new-logo-only-green-1.svg"
    />

    <title>{title}</title>
    <script
      id="Cookiebot"
      src="https://consent.cookiebot.com/uc.js"
      data-cbid="dc9e07d5-dc72-477b-ab85-798ff7e1ee18"
      data-blockingmode="auto"
      type="text/javascript"></script>
    <meta name="description" content={description} />

    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content={ogImage} />
    <meta property="og:url" content={Astro.url.href} />
  </head>

  <body>
    <Navbar />
    <main>
      <slot />
    </main>
    <Footer />

    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const sectionsToAnimate =
          document.querySelectorAll(".slide-in-section");

        const observerOptions = {
          root: null, // relative to the viewport
          rootMargin: "0px",
          threshold: 0.1, // Trigger when 10% of the element is visible
        };

        const observerCallback = (entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              // When element enters viewport, add the trigger class
              entry.target.classList.add("is-visible");
              // Stop observing it after it's visible
              observer.unobserve(entry.target);
            }
          });
        };

        // Only create the observer if there are elements to observe
        if (sectionsToAnimate.length > 0) {
          const sectionObserver = new IntersectionObserver(
            observerCallback,
            observerOptions
          );

          sectionsToAnimate.forEach((section) => {
            sectionObserver.observe(section);
          });
        }
      });
    </script>
  </body>
</html>

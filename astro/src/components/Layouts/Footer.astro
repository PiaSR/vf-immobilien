---
// Import the necessary components and data as before
import { Image } from "astro:assets";
import VikiLogo from "../../../public/logos/Viki-new-logo-white-1-with-writing-1.svg";
import Linkedin from "../../../public/icons/Linkedin-1.svg";
import Instagram from "../../../public/icons/Instagram-1.svg";
import Facebook from "../../../public/icons/Facebook-1.svg";
import EmailIcon from "../../../public/icons/email-icon-1.svg";
import PhoneIcon from "../../../public/icons/phone-icon-1.svg";
import LocationIcon from "../../../public/icons/location-icon-1.svg";

// Sanity Imports (ADJUST PATHS HERE!)
import { sanityClient, type OfficeDetails } from "../../lib/sanityClient";

// Define the GROQ Query
const officeDetailsQuery = `
  *[_type == "officeDetails"][0] {
    email,
    phone,
    streetAddress,
    cityPostal,
    facebookUrl,
    instagramUrl,
    linkedinUrl,
  }
`;

// Fetch the Data
const officeDetails: OfficeDetails | null =
  await sanityClient.fetch(officeDetailsQuery);

// Fallback data
const fallback = {
  email: "office@vf-immobilien.at",
  phone: "+43 123 456 849",
  streetAddress: "Auhofstrasse 78C/1",
  cityPostal: "1130 Wien",
  facebookUrl: "http://www.facebook.com",
  instagramUrl: "http://www.instagram.com",
  linkedinUrl: "http://www.linkedin.com",
};

// Use fetched data or fallback
const data = officeDetails || fallback;

// Helper functions for linking
const cleanPhoneNumber = data.phone.replace(/[\s\-\(\)]/g, "");
const rawAddress = `${data.streetAddress}, ${data.cityPostal}`;
const mapAddressUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(rawAddress)}`;
---

<footer class="main-footer">
  <div class="footer-container">
    <div class="footer-logo-section">
      <Image
        src={VikiLogo}
        alt="Viki Frohner Immobilien"
        class="footer-logo"
        width="150"
        height="150"
      />
      <div class="footer-divider"></div>
      <div class="footer-tagline">Verwaltung, gebaut auf Vertrauen.</div>
      <div class="footer-socials">
        {
          data.linkedinUrl && data.linkedinUrl !== "#" && (
            <a
              href={data.linkedinUrl}
              class="social-link"
              target="_blank"
              rel="noopener noreferrer"
            >
              <Image src={Linkedin} loading="lazy" alt="Linkedin" />
            </a>
          )
        }

        <a href="#" class="social-link"
          ><Image src={Instagram} loading="lazy" alt="Instagram" /></a
        >
        <a href="#" class="social-link"
          ><Image src={Facebook} loading="lazy" alt="Facebook" /></a
        >
      </div>
    </div>

    <div class="footer-links-container">
      <div class="footer-links">
        <div class="links-group">
          <a href="about.html" class="links-header-link">
            <h6 class="links-header">Ãœber uns</h6>
          </a>
          <a href="about.html#about-team" class="link-item">Team</a>
          <a href="about.html#about-history" class="link-item">Entstehung</a>
          <a href="about.html#about-values" class="link-item">Werte</a>
        </div>
        <div class="links-group">
          <a href="services.html" class="links-header-link">
            <h6 class="links-header">Leistungen</h6>
          </a>
          <a href="services.html#services-hausverwaltung" class="link-item"
            >Hausverwaltung</a
          >
          <a href="services.html#services-vermittlung" class="link-item"
            >Immobilienvermittlung</a
          >
          <a href="faq.html" class="link-item">FAQs & Dokumente</a>

          <a href="services.html#subscription" class="link-item"
            >Suchvorvermerkung</a
          >
        </div>
        <div class="links-group">
          <a href="immobiliensuche.html" class="links-header-link">
            <h6 class="links-header">Immobiliensuche</h6>
          </a>
          <a href="immobiliensuche.html#suchprofil" class="link-item"
            >Suchprofil</a
          >
          <a href="immobiliensuche.html#kaufen" class="link-item">Kaufen</a>
          <a href="immobiliensuche.html#mieten" class="link-item">Mieten</a>
        </div>
      </div>

      <div class="footer-contact-details">
        <a href={`mailto:${data.email}`} class="contact-line">
          <Image
            src={EmailIcon}
            loading="lazy"
            alt="Email icon"
            class="contact-icon"
          />
          <div class="contact-text">{data.email}</div>
        </a>

        <a href={`tel:${cleanPhoneNumber}`} class="contact-line">
          <Image
            src={PhoneIcon}
            loading="lazy"
            alt="Phone icon"
            class="contact-icon"
          />
          <div class="contact-text">{data.phone}</div>
        </a>

        <a
          href={mapAddressUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="contact-line"
        >
          <Image
            src={LocationIcon}
            loading="lazy"
            alt="Location icon"
            class="contact-icon"
          />
          <div class="contact-text">
            {data.streetAddress},<br />
            {data.cityPostal}
          </div>
        </a>
      </div>
    </div>
  </div>
</footer>

<style>
  /* * ======================================================================
   * NEW/MODIFIED STYLES FOR CLICKABLE HEADERS
   * ======================================================================
  */

  /* Style the new anchor tag wrapper to behave like the h6 */
  .links-header-link {
    /* Inherit the link color and remove the default underline */
    color: var(--color-neutral-light-grey);
    text-decoration: none;
    display: block; /* Ensures it takes up full width for clicking */

    /* Preserve space below the header */
    margin-bottom: var(--spacing-lg);

    /* Enable hover effect */
    opacity: 1; /* Always fully visible */
    transition: opacity 0.2s ease;
  }

  .links-header-link:hover {
    color: var(--color-neutral-white); /* Example hover color */
    opacity: 1;
  }

  /* Remove the margin-bottom from h6 since it's now on the parent <a> */
  .links-header {
    margin-bottom: 0;
  }

  /*
   * ======================================================================
   * EXISTING STYLES
   * ======================================================================
  */

  .main-footer {
    background-color: var(--color-brand-dark-green);
    color: var(--color-neutral-white);
    padding: var(--spacing-2xl) var(--spacing-2xl);
    font-family: var(--font-primary);
    display: flex;
    justify-content: center;
    gap: var(--spacing-2xl);
    flex-wrap: wrap;

    width: 100%;
  }

  .footer-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 80rem;
  }
  .footer-logo-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-md);

    padding-bottom: var(--spacing-md);
  }

  .footer-logo {
    width: 14rem;
  }

  .footer-tagline {
    font-size: var(--font-size-body-se);
    font-weight: var(--font-weight-semi-bold);
    margin-top: var(--spacing-md);
  }
  .footer-divider {
    height: 0px;
    width: 100%;
    border: 1px solid var(--color-neutral-white);
  }
  .footer-socials {
    display: flex;
    gap: var(--spacing-xl);
  }

  .footer-socials .social-link img {
    width: var(--spacing-lg);
    height: var(--spacing-lg);
  }

  .footer-links-container {
    display: flex;
    justify-content: end;
    flex: 2;
    gap: var(--spacing-2xl);
    flex-wrap: wrap;
  }

  .footer-links {
    display: flex;
    gap: var(--spacing-xl);
    flex-wrap: wrap;
  }

  .links-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .links-header {
    font-family: var(--font-primary);
    font-size: var(--font-size-h6);
    font-weight: var(--font-weight-semi-bold);
    /* margin-bottom: var(--spacing-lg); REMOVED/SET TO 0 ABOVE */
    color: inherit; /* Ensure h6 text color comes from the parent <a> */
  }

  .link-item,
  .contact-text {
    font-size: var(--font-size-body-small);
    color: var(--color-neutral-white);
    text-decoration: none;
    opacity: 0.8;
    transition: opacity 0.2s ease;
  }

  .link-item:hover,
  .contact-text:hover {
    opacity: 1;
  }

  .footer-contact-details {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .footer-contact-details .contact-line {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    color: var(--color-neutral-white);
    font-size: var(--font-size-body-small);
    text-decoration: none;
    /* opacity: 0.8; */
    transition: opacity 0.2s ease;
  }
</style>

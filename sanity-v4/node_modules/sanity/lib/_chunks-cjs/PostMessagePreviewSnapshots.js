"use strict";
var reactCompilerRuntime = require("react-compiler-runtime"), React = require("react"), rxjs = require("rxjs"), sanity = require("sanity");
const PostMessagePreviews = (props) => {
  const $ = reactCompilerRuntime.c(16), {
    comlink,
    refs,
    perspective
  } = props, documentPreviewStore = sanity.useDocumentPreviewStore(), schema = sanity.useSchema();
  let t0;
  $[0] === Symbol.for("react.memo_cache_sentinel") ? (t0 = new rxjs.Subject(), $[0] = t0) : t0 = $[0];
  const refsSubject = t0;
  let t1;
  $[1] !== documentPreviewStore || $[2] !== perspective || $[3] !== schema ? (t1 = refsSubject.asObservable().pipe(rxjs.switchMap((refs_0) => rxjs.combineLatest(refs_0.map((ref) => {
    const draftRef = {
      ...ref,
      _id: sanity.getDraftId(ref._id)
    }, draft$ = perspective === "published" ? rxjs.NEVER : documentPreviewStore.observeForPreview(draftRef, schema.get(draftRef._type)).pipe(rxjs.share(), rxjs.skipWhile(_temp)), publishedRef = {
      ...ref,
      _id: sanity.getPublishedId(ref._id)
    }, published$ = documentPreviewStore.observeForPreview(publishedRef, schema.get(publishedRef._type));
    return rxjs.merge(published$.pipe(rxjs.takeUntil(draft$)), draft$).pipe(rxjs.filter(_temp2), rxjs.map(_temp3));
  }))), rxjs.debounceTime(0)), $[1] = documentPreviewStore, $[2] = perspective, $[3] = schema, $[4] = t1) : t1 = $[4];
  const previews$ = t1;
  let t2;
  $[5] === Symbol.for("react.memo_cache_sentinel") ? (t2 = [], $[5] = t2) : t2 = $[5];
  const lastSnapshots = React.useRef(t2);
  let t3, t4;
  $[6] !== comlink || $[7] !== previews$ ? (t3 = () => {
    const sub = previews$.subscribe((snapshots) => {
      comlink.post("presentation/preview-snapshots", {
        snapshots
      }), lastSnapshots.current = snapshots;
    });
    return () => {
      sub.unsubscribe();
    };
  }, t4 = [comlink, previews$], $[6] = comlink, $[7] = previews$, $[8] = t3, $[9] = t4) : (t3 = $[8], t4 = $[9]), React.useEffect(t3, t4);
  let t5, t6;
  $[10] !== comlink ? (t5 = () => comlink.on("visual-editing/preview-snapshots", () => ({
    snapshots: lastSnapshots.current
  })), t6 = [comlink], $[10] = comlink, $[11] = t5, $[12] = t6) : (t5 = $[11], t6 = $[12]), React.useEffect(t5, t6);
  let t7, t8;
  return $[13] !== refs ? (t7 = () => {
    refsSubject.next(refs);
  }, t8 = [refs, refsSubject], $[13] = refs, $[14] = t7, $[15] = t8) : (t7 = $[14], t8 = $[15]), React.useEffect(t7, t8), null;
};
var PostMessagePreviewSnapshots = React.memo(PostMessagePreviews);
function _temp(p) {
  return p.snapshot === null;
}
function _temp2(p_0) {
  return !!p_0.snapshot;
}
function _temp3(p_1) {
  const snapshot = p_1.snapshot;
  return {
    _id: sanity.getPublishedId(snapshot._id),
    title: snapshot.title,
    subtitle: snapshot.subtitle,
    description: snapshot.description,
    imageUrl: snapshot.imageUrl
  };
}
exports.default = PostMessagePreviewSnapshots;
//# sourceMappingURL=PostMessagePreviewSnapshots.js.map

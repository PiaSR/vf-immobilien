{"version":3,"file":"presentation.js","sources":["../../src/presentation/overlays/useSharedState.ts","../../src/presentation/constants.ts","../../src/presentation/i18n/index.ts","../../src/presentation/usePresentationPerspectiveStack.ts","../../src/presentation/useDocumentLocations.ts","../../src/presentation/usePresentationTool.ts","../../src/presentation/document/useCurrentPresentationToolName.ts","../../src/presentation/document/LocationsBanner.tsx","../../src/presentation/document/PresentationDocumentHeader.tsx","../../src/presentation/document/PresentationDocumentProvider.tsx","../../src/presentation/fieldActions/openInStructure.ts","../../src/presentation/getIntentState.ts","../../src/presentation/PresentationSpinner.tsx","../../src/presentation/router.ts","../../src/presentation/plugin.tsx","../../src/presentation/usePresentationNavigate.ts","../../src/presentation/usePresentationParams.ts"],"sourcesContent":["import {type Serializable} from '@sanity/presentation-comlink'\nimport {useContext, useEffect} from 'react'\nimport {PresentationSharedStateContext} from 'sanity/_singletons'\n\n/** @public */\nexport const useSharedState = (key: string, value: Serializable): undefined => {\n  const context = useContext(PresentationSharedStateContext)\n\n  if (!context) {\n    throw new Error('Preview Snapshots context is missing')\n  }\n\n  const {setValue} = context\n\n  useEffect(() => {\n    setValue(key, value)\n  }, [key, value, setValue])\n\n  return undefined\n}\n","import {ComposeIcon} from '@sanity/icons'\nimport {apiVersion} from '@sanity/preview-url-secret/constants'\n\nexport const DEFAULT_TOOL_ICON = ComposeIcon\nexport const DEFAULT_TOOL_NAME = 'presentation'\nexport const DEFAULT_TOOL_TITLE = 'Presentation'\n\nexport const EDIT_INTENT_MODE = 'presentation'\n\n// How long we wait until an iframe is loaded until we consider it to be slow and possibly failed\nexport const MAX_TIME_TO_OVERLAYS_CONNECTION = 3_000 // ms\n\n// The API version to use when using `@sanity/client`\nexport const API_VERSION = apiVersion\n\n// Heartbeats shouldn't fire on intervals that are so short it causes performance issues\nexport const MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL = 1000 // ms\n\n// How often the list over loader queries should be garbage collected\nexport const LOADER_QUERY_GC_INTERVAL = 30_000 // ms\n\n// The interval at which we check if existing popups have been closed\nexport const POPUP_CHECK_INTERVAL = 1000 // ms\n","import {defineLocaleResourceBundle} from 'sanity'\n\n/**\n * The locale namespace for the presentation tool\n *\n * @public\n */\nexport const presentationLocaleNamespace = 'presentation' as const\n\n/**\n * The default locale bundle for the presentation tool, which is US English.\n *\n * @internal\n */\nexport const presentationUsEnglishLocaleBundle = defineLocaleResourceBundle({\n  locale: 'en-US',\n  namespace: presentationLocaleNamespace,\n  resources: () => import('./resources'),\n})\n","import {useContext} from 'react'\nimport {usePerspective} from 'sanity'\nimport {PaneRouterContext} from 'sanity/structure'\n\nexport function usePresentationPerspectiveStack() {\n  const {perspectiveStack} = usePerspective()\n  const paneRouter = useContext(PaneRouterContext)\n  if (!paneRouter) {\n    throw new Error('PaneRouter not found')\n  }\n  const scheduledDraftPerspective = paneRouter.params?.scheduledDraft\n\n  if (scheduledDraftPerspective) {\n    return [scheduledDraftPerspective, ...perspectiveStack]\n  }\n  return perspectiveStack\n}\n","import {useEffect, useMemo, useState} from 'react'\nimport {isObservable, map, of} from 'rxjs'\nimport {\n  type ObjectSchemaType,\n  type PreviewableType,\n  useDocumentPreviewStore,\n  useDocumentStore,\n} from 'sanity'\n\nimport {\n  type DocumentLocationResolver,\n  type DocumentLocationResolvers,\n  type DocumentLocationsState,\n  type DocumentLocationsStatus,\n} from './types'\nimport {usePresentationPerspectiveStack} from './usePresentationPerspectiveStack'\n\nconst INITIAL_STATE: DocumentLocationsState = {locations: []}\n\nexport function useDocumentLocations(props: {\n  id: string\n  version: string | undefined\n  resolvers?: DocumentLocationResolver | DocumentLocationResolvers\n  type: ObjectSchemaType\n}): {\n  state: DocumentLocationsState\n  status: DocumentLocationsStatus\n} {\n  const {id, resolvers, type, version} = props\n  const documentStore = useDocumentStore()\n  const documentPreviewStore = useDocumentPreviewStore()\n\n  const perspectiveStack = usePresentationPerspectiveStack()\n  const [locationsState, setLocationsState] = useState<DocumentLocationsState>(INITIAL_STATE)\n\n  const resolver = resolvers && (typeof resolvers === 'function' ? resolvers : resolvers[type.name])\n\n  const [locationsStatus, setLocationsStatus] = useState<DocumentLocationsStatus>(\n    resolver ? 'resolving' : 'empty',\n  )\n\n  const result = useMemo(() => {\n    if (!resolver) return undefined\n\n    // Original/advanced resolver which requires explicit use of Observables\n    if (typeof resolver === 'function') {\n      const params = {id, type: type.name, version, perspectiveStack}\n      const context = {documentStore}\n      const _result = resolver(params, context)\n      return isObservable(_result) ? _result : of(_result)\n    }\n\n    // Simplified resolver pattern which abstracts away Observable logic\n    if ('select' in resolver && 'resolve' in resolver) {\n      const doc = {_type: 'reference', _ref: id}\n      // Override the preview selection in the schema type to use the user\n      // defined selection defined by the resolver\n      const _type = {...type, preview: {select: resolver.select}} satisfies PreviewableType\n      const options = {perspective: perspectiveStack}\n      return documentPreviewStore\n        .observeForPreview(doc, _type, options)\n        .pipe(map((preview) => resolver.resolve(preview.snapshot || null)))\n    }\n\n    // Resolver is explicitly provided state\n    return of(resolver)\n  }, [documentStore, documentPreviewStore, id, resolver, type, version, perspectiveStack])\n\n  useEffect(() => {\n    const sub = result?.subscribe((state) => {\n      setLocationsState(state || INITIAL_STATE)\n      setLocationsStatus(state ? 'resolved' : 'empty')\n    })\n\n    return () => sub?.unsubscribe()\n  }, [result])\n\n  return {\n    state: locationsState,\n    status: locationsStatus,\n  }\n}\n","import {useContext} from 'react'\nimport {PresentationContext} from 'sanity/_singletons'\n\nimport {type PresentationContextValue} from './types'\n\nexport function usePresentationTool(throwOnMissingContext?: true): PresentationContextValue\nexport function usePresentationTool(throwOnMissingContext: false): PresentationContextValue | null\nexport function usePresentationTool(throwOnMissingContext = true): PresentationContextValue | null {\n  const presentation = useContext(PresentationContext)\n\n  if (throwOnMissingContext && !presentation) {\n    throw new Error('Presentation context is missing')\n  }\n\n  return presentation\n}\n","import {usePresentationTool} from '../usePresentationTool'\n\nexport function useCurrentPresentationToolName(): string | undefined {\n  return usePresentationTool(false)?.name ?? undefined\n}\n","import {\n  ChevronRightIcon,\n  DesktopIcon,\n  ErrorOutlineIcon,\n  InfoOutlineIcon,\n  WarningOutlineIcon,\n} from '@sanity/icons'\nimport {Box, Card, Flex, Spinner, Stack, Text} from '@sanity/ui'\nimport {type ComponentType, type ReactNode, useCallback, useContext, useState} from 'react'\nimport {type ObjectSchemaType, useTranslation} from 'sanity'\nimport {PresentationContext} from 'sanity/_singletons'\nimport {useIntentLink} from 'sanity/router'\nimport {usePaneRouter} from 'sanity/structure'\n\nimport {DEFAULT_TOOL_NAME, DEFAULT_TOOL_TITLE} from '../constants'\nimport {presentationLocaleNamespace} from '../i18n'\nimport {\n  type DocumentLocation,\n  type DocumentLocationResolver,\n  type DocumentLocationResolvers,\n  type PresentationPluginOptions,\n} from '../types'\nimport {useDocumentLocations} from '../useDocumentLocations'\nimport {useCurrentPresentationToolName} from './useCurrentPresentationToolName'\n\nconst TONE_ICONS: Record<'positive' | 'caution' | 'critical', ComponentType> = {\n  positive: InfoOutlineIcon,\n  caution: WarningOutlineIcon,\n  critical: ErrorOutlineIcon,\n}\n\nexport function LocationsBanner(props: {\n  documentId: string\n  options: PresentationPluginOptions\n  resolvers?: DocumentLocationResolver | DocumentLocationResolvers\n  schemaType: ObjectSchemaType\n  showPresentationTitle: boolean\n  version: string | undefined\n}): ReactNode {\n  const {documentId, options, resolvers, schemaType, showPresentationTitle, version} = props\n\n  const {state, status} = useDocumentLocations({\n    id: documentId,\n    version,\n    resolvers,\n    type: schemaType,\n  })\n\n  const isResolving = status === 'resolving'\n\n  const {locations, message, tone} = state\n  const locationsCount = locations?.length || 0\n\n  const {t} = useTranslation(presentationLocaleNamespace)\n  const presentation = useContext(PresentationContext)\n  const presentationName = presentation?.name\n  const [expanded, setExpanded] = useState(false)\n  const toggle = useCallback(() => {\n    if (!locationsCount) return\n    setExpanded((v) => !v)\n  }, [locationsCount])\n\n  const title = isResolving\n    ? t('locations-banner.resolving.text')\n    : message || t('locations-banner.locations-count', {count: locationsCount})\n\n  const ToneIcon = tone ? TONE_ICONS[tone] : undefined\n\n  if (!resolvers || status === 'empty') return null\n  return (\n    <Card padding={1} radius={2} border tone={tone}>\n      <div style={{margin: -1}}>\n        {!locations && (\n          <Flex align=\"flex-start\" gap={3} padding={3}>\n            {tone && ToneIcon && (\n              <Box flex=\"none\">\n                <Text size={1}>\n                  <ToneIcon />\n                </Text>\n              </Box>\n            )}\n            <Box flex={1}>\n              <Text size={1} weight=\"medium\">\n                {showPresentationTitle && <>{options.title || DEFAULT_TOOL_TITLE} &middot; </>}\n                {title}\n              </Text>\n            </Box>\n          </Flex>\n        )}\n        {locations && (\n          <>\n            <Card\n              as={locationsCount ? 'button' : undefined}\n              onClick={toggle}\n              padding={3}\n              radius={1}\n              tone=\"inherit\"\n            >\n              <Flex gap={3}>\n                <Box flex=\"none\">\n                  {isResolving ? (\n                    <Spinner size={1} />\n                  ) : (\n                    <Text size={1}>\n                      {locationsCount === 0 ? (\n                        <InfoOutlineIcon />\n                      ) : (\n                        <ChevronRightIcon\n                          style={{\n                            transform: `rotate(${expanded ? '90deg' : 0})`,\n                            transition: 'transform 100ms ease-in-out',\n                          }}\n                        />\n                      )}\n                    </Text>\n                  )}\n                </Box>\n                <Box flex={1}>\n                  <Text size={1} weight=\"medium\">\n                    {showPresentationTitle && <>{options.title || DEFAULT_TOOL_TITLE} &middot; </>}\n                    {title}\n                  </Text>\n                </Box>\n              </Flex>\n            </Card>\n            <Stack hidden={!expanded} marginTop={1} space={1}>\n              {locations.map((l) => {\n                let active = false\n                if (\n                  (options.name || DEFAULT_TOOL_NAME) === presentationName &&\n                  presentation?.params.preview\n                ) {\n                  active = areUrlsMatching(presentation.params.preview, l.href)\n                }\n\n                return (\n                  <LocationItem\n                    key={l.href}\n                    active={active}\n                    documentId={documentId}\n                    documentType={schemaType.name}\n                    node={l}\n                    toolName={options.name || DEFAULT_TOOL_NAME}\n                  />\n                )\n              })}\n            </Stack>\n          </>\n        )}\n      </div>\n    </Card>\n  )\n}\n\nfunction LocationItem(props: {\n  active: boolean\n  documentId: string\n  documentType: string\n  node: DocumentLocation\n  toolName: string\n}) {\n  const {documentId, documentType, node, active, toolName} = props\n  const presentation = useContext(PresentationContext)\n  const currentPresentationToolName = useCurrentPresentationToolName()\n  const isCurrentTool = toolName === currentPresentationToolName\n  const navigate = presentation?.navigate\n  const {params: paneParams} = usePaneRouter()\n\n  const presentationLinkProps = useIntentLink({\n    intent: 'edit',\n    params: {\n      id: documentId,\n      type: documentType,\n      mode: 'presentation',\n      presentation: toolName,\n      ...presentation?.structureParams,\n      ...paneParams,\n      preview: node.href,\n    },\n  })\n\n  const handleCurrentToolClick = useCallback(() => {\n    navigate?.({params: {preview: node.href}})\n  }, [node.href, navigate])\n\n  return (\n    <Card\n      key={node.href}\n      {...(isCurrentTool ? {} : presentationLinkProps)}\n      as=\"a\"\n      onClick={isCurrentTool ? handleCurrentToolClick : presentationLinkProps.onClick}\n      padding={3}\n      radius={1}\n      pressed={active}\n      tone=\"inherit\"\n    >\n      <Flex gap={3}>\n        <Box flex=\"none\">\n          <Text size={1}>\n            <DesktopIcon />\n          </Text>\n        </Box>\n        <Stack flex={1} space={2}>\n          <Text size={1} weight=\"medium\">\n            {node.title}\n          </Text>\n          <Text muted size={1} textOverflow=\"ellipsis\">\n            {node.href}\n          </Text>\n        </Stack>\n      </Flex>\n    </Card>\n  )\n}\n\n/**\n * Compares two URLs to determine if they match based on origin, pathname, and search parameters\n * The previewUrl should have all the search parameters that are in the locationUrl\n */\nfunction areUrlsMatching(previewUrlString: string, locationUrlString: string): boolean {\n  try {\n    const previewUrl = new URL(previewUrlString, location.origin)\n    const locationUrl = new URL(locationUrlString, previewUrl.origin)\n\n    // First compare origin and pathname\n    if (previewUrl.origin !== locationUrl.origin || previewUrl.pathname !== locationUrl.pathname) {\n      return false\n    }\n\n    // Then check search params\n    // All search params in locationUrl must exist with the same values in previewUrl\n    const locationParams = new URLSearchParams(locationUrl.search)\n    const previewParams = new URLSearchParams(previewUrl.search)\n\n    for (const [key, value] of locationParams.entries()) {\n      if (previewParams.get(key) !== value) {\n        return false\n      }\n    }\n\n    return true\n  } catch {\n    // If URL parsing fails, URLs don't match\n    return false\n  }\n}\n","import {rem} from '@sanity/ui'\n// eslint-disable-next-line camelcase\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport {type ReactNode, useContext} from 'react'\nimport {type ObjectSchemaType, type PublishedId} from 'sanity'\nimport {PresentationDocumentContext} from 'sanity/_singletons'\nimport {css, styled} from 'styled-components'\n\nimport {type PresentationPluginOptions} from '../types'\nimport {LocationsBanner} from './LocationsBanner'\n\nconst LocationStack = styled.div((props) => {\n  const theme = getTheme_v2(props.theme)\n  return css`\n    display: flex;\n    flex-direction: column;\n    gap: ${rem(theme.space[2])};\n    min-height: ${rem(42)};\n    margin-bottom: ${rem(theme.space[5])};\n\n    &:empty {\n      display: none;\n    }\n  `\n})\n\nexport function PresentationDocumentHeader(props: {\n  documentId: PublishedId\n  version: string | undefined\n  options: PresentationPluginOptions\n  schemaType: ObjectSchemaType\n}): ReactNode {\n  const {documentId, options, schemaType, version} = props\n  const context = useContext(PresentationDocumentContext)\n\n  const contextOptions = context?.options || []\n  const resolvers = contextOptions.map((o) => o.resolve?.locations || o.locate)\n  const hasResolvers = resolvers.some(Boolean)\n\n  if ((context && context.options[0] !== options) || !hasResolvers) {\n    return null\n  }\n\n  return (\n    <LocationStack>\n      {contextOptions.map((_options, idx) => (\n        <LocationsBanner\n          // oxlint-disable-next-line no-array-index-key\n          key={idx}\n          documentId={documentId}\n          options={_options}\n          resolvers={resolvers[idx]}\n          schemaType={schemaType}\n          showPresentationTitle={contextOptions.length > 1}\n          version={version}\n        />\n      ))}\n    </LocationStack>\n  )\n}\n","import {type ReactNode, useCallback, useContext, useLayoutEffect, useMemo, useState} from 'react'\nimport {PresentationDocumentContext} from 'sanity/_singletons'\nimport {useEffectEvent} from 'use-effect-event'\n\nimport {type PresentationPluginOptions} from '../types'\nimport {type PresentationDocumentContextValue} from './types'\n\n/** @internal */\nexport function PresentationDocumentProvider(props: {\n  children?: ReactNode\n  options: PresentationPluginOptions\n}): React.JSX.Element {\n  const {children, options} = props\n  const parent = useContext(PresentationDocumentContext)\n  const parentRegister = parent?.register\n\n  const [optionsArray, setOptionsArray] = useState<PresentationPluginOptions[]>(() => [])\n\n  const register = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    (options: PresentationPluginOptions) => {\n      if (parentRegister) {\n        return parentRegister(options)\n      }\n\n      setOptionsArray((prev) => [options].concat(prev))\n\n      return () => {\n        setOptionsArray((prev) => prev.filter((o) => o !== options))\n      }\n    },\n    [parentRegister],\n  )\n\n  const context: PresentationDocumentContextValue = useMemo(\n    () => ({\n      options: parent?.options || optionsArray,\n      register,\n    }),\n    [optionsArray, parent, register],\n  )\n\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  const registerEffectEvent = useEffectEvent((options: PresentationPluginOptions) =>\n    register(options),\n  )\n  useLayoutEffect(() => registerEffectEvent(options), [options])\n\n  return (\n    <PresentationDocumentContext.Provider value={context}>\n      {children}\n    </PresentationDocumentContext.Provider>\n  )\n}\n","import {MasterDetailIcon} from '@sanity/icons'\nimport {useContext, useMemo} from 'react'\nimport {\n  defineDocumentFieldAction,\n  type DocumentFieldActionGroup,\n  type DocumentFieldActionItem,\n  type DocumentFieldActionProps,\n  isRecord,\n  pathToString,\n  type Tool,\n  useWorkspace,\n} from 'sanity'\nimport {PresentationContext} from 'sanity/_singletons'\nimport {useRouter} from 'sanity/router'\n\nimport {DEFAULT_TOOL_NAME} from '../constants'\n\nfunction useOpenInStructureAction(\n  props: DocumentFieldActionProps,\n): DocumentFieldActionItem | DocumentFieldActionGroup {\n  const {documentId, documentType, path} = props\n  const workspace = useWorkspace()\n  const {navigateIntent} = useRouter()\n  const presentation = useContext(PresentationContext)\n\n  const defaultStructureTool = useMemo(\n    () =>\n      findStructureTool(\n        workspace.tools,\n        documentId,\n        documentType,\n        presentation?.name || DEFAULT_TOOL_NAME,\n      ),\n    [documentId, documentType, workspace.tools, presentation],\n  )\n\n  return {\n    type: 'action',\n    hidden: !presentation || path.length > 0 || !defaultStructureTool,\n    icon: defaultStructureTool?.icon || MasterDetailIcon,\n    title: `Open in ${defaultStructureTool?.title || 'Structure'}`,\n    onAction() {\n      navigateIntent('edit', {\n        id: documentId,\n        type: documentType,\n        mode: 'structure',\n        path: pathToString(path),\n      })\n    },\n    renderAsButton: true,\n  }\n}\n\nexport const openInStructure = defineDocumentFieldAction({\n  name: 'presentation/openInStructure',\n  useAction: useOpenInStructureAction,\n})\n\nfunction findStructureTool(\n  tools: Tool[],\n  documentId: string,\n  documentType: string,\n  presentationToolName?: string,\n): Tool | undefined {\n  const results = tools\n    .filter((t) => t.name !== presentationToolName)\n    .map((t) => {\n      const match = t.canHandleIntent?.(\n        'edit',\n        {\n          id: documentId,\n          type: documentType,\n          mode: 'structure',\n        },\n        {},\n      )\n\n      return {tool: t, match}\n    })\n\n  const modeMatches = results.filter((t) => isRecord(t.match) && t.match.mode)\n\n  if (modeMatches.length > 0) {\n    return modeMatches[0].tool\n  }\n\n  const matches = results.filter((t) => t.match)\n\n  return matches[0]?.tool\n}\n","import {uuid} from '@sanity/uuid'\nimport {getPublishedId} from 'sanity'\nimport {encodeJsonParams, type RouterState, type SearchParam} from 'sanity/router'\n\nimport {type PresentationSearchParams, type PresentationStateParams} from './types'\n\nconst preservedSearchParamKeys: Array<keyof PresentationSearchParams> = ['preview', 'viewport']\n\n/**\n * @internal\n */\nexport function getIntentState(\n  intent: string,\n  params: Record<string, string>,\n  routerState: RouterState | undefined,\n  payload: unknown,\n):\n  | (PresentationStateParams & {_searchParams: SearchParam[]})\n  | {intent: string; params: Record<string, string>; payload: unknown} {\n  // oxlint-disable-next-line no-unused-vars\n  const {id, mode, path, presentation, type, ...searchParams} = params\n\n  const preservedSearchParams = (routerState?._searchParams || [])\n    // @todo Casting https://github.com/microsoft/TypeScript/issues/14520\n    .filter(([key]) => preservedSearchParamKeys.includes(key as keyof PresentationSearchParams))\n    .reduce((acc, [key, value]) => ({...acc, [key]: value}), {} as Record<string, string>)\n\n  const _searchParams = {\n    ...preservedSearchParams,\n    ...searchParams,\n  }\n\n  if (intent === 'edit' && id) {\n    _searchParams.preview =\n      _searchParams.preview || new URLSearchParams(window.location.search).get('preview') || '/'\n    return {\n      type: type || '*',\n      id: getPublishedId(id),\n      path,\n      _searchParams: Object.entries(_searchParams),\n    }\n  }\n\n  if (intent === 'create') {\n    _searchParams.preview =\n      _searchParams.preview || new URLSearchParams(window.location.search).get('preview') || '/'\n\n    if (payload && typeof payload === 'object') {\n      _searchParams.templateParams = encodeJsonParams(payload as Record<string, unknown>)\n    }\n\n    return {\n      type: type || '*',\n      id: id || uuid(),\n      _searchParams: Object.entries(_searchParams),\n    }\n  }\n  return {intent, params, payload}\n}\n","import {Flex, Spinner} from '@sanity/ui'\n\nexport function PresentationSpinner(): React.JSX.Element {\n  return (\n    <Flex align=\"center\" direction=\"column\" height=\"fill\" justify=\"center\" style={{width: '100%'}}>\n      <Spinner />\n    </Flex>\n  )\n}\n","import {route} from 'sanity/router'\n\n// eslint-disable-next-line camelcase\nexport const router = route.create('/', {__unsafe_disableScopedSearchParams: true}, [\n  route.intents('/intent'),\n  route.create(':type', [route.create(':id', [route.create(':path')])]),\n])\n","import {type SanityDocument} from '@sanity/client'\nimport {lazy, Suspense} from 'react'\nimport {\n  definePlugin,\n  getPublishedId,\n  getVersionFromId,\n  type InputProps,\n  isDocumentSchemaType,\n} from 'sanity'\n\nimport {DEFAULT_TOOL_ICON, DEFAULT_TOOL_NAME, EDIT_INTENT_MODE} from './constants'\nimport {PresentationDocumentHeader} from './document/PresentationDocumentHeader'\nimport {PresentationDocumentProvider} from './document/PresentationDocumentProvider'\nimport {openInStructure} from './fieldActions/openInStructure'\nimport {getIntentState} from './getIntentState'\nimport {presentationUsEnglishLocaleBundle} from './i18n'\nimport {PresentationSpinner} from './PresentationSpinner'\nimport {router} from './router'\nimport {\n  type DocumentLocationResolverObject,\n  type DocumentLocationsState,\n  type DocumentResolver,\n  type PresentationPluginOptions,\n} from './types'\n\nconst PresentationTool = lazy(() => import('./PresentationToolGrantsCheck'))\nconst BroadcastDisplayedDocument = lazy(() => import('./loader/BroadcastDisplayedDocument'))\n\n/**\n * Define locations for a given document type.\n * This function doesn't do anything itself, it is used to provide type information.\n * @param resolver - resolver that return locations for a document.\n * @public\n */\nexport function defineLocations<K extends string>(\n  resolver: DocumentLocationResolverObject<K> | DocumentLocationsState,\n): typeof resolver {\n  return resolver\n}\n\n/**\n * Define documents for a given location.\n * This function doesn't do anything itself, it is used to provide type information.\n * @param resolvers - resolvers that return documents.\n * @public\n */\nexport function defineDocuments(resolvers: DocumentResolver[]): typeof resolvers {\n  return resolvers\n}\n\n/** @public */\nexport const presentationTool = definePlugin<PresentationPluginOptions>((options) => {\n  const toolName = options.name || DEFAULT_TOOL_NAME\n\n  if ('locate' in options) {\n    console.warn('Presentationâ€™s `locate` option is deprecated. Use `resolve.locations` instead.')\n  }\n\n  const hasLocationsResolver = !!(options.resolve?.locations || options.locate)\n\n  function PresentationDocumentInput(props: InputProps) {\n    const value = props.value as SanityDocument\n    const documentId = value?._id ? getPublishedId(value?._id) : undefined\n    const documentVersion = value?._id ? getVersionFromId(value._id) : undefined\n    if (isDocumentSchemaType(props.schemaType)) {\n      return (\n        <PresentationDocumentProvider options={options}>\n          {hasLocationsResolver && documentId && (\n            <PresentationDocumentHeader\n              documentId={documentId}\n              version={documentVersion}\n              options={options}\n              schemaType={props.schemaType}\n            />\n          )}\n          <Suspense fallback={<PresentationSpinner />}>{props.renderDefault(props)}</Suspense>\n          <Suspense key=\"broadcast-displayed-document\">\n            <BroadcastDisplayedDocument key={documentId} value={value} />\n          </Suspense>\n        </PresentationDocumentProvider>\n      )\n    }\n\n    return props.renderDefault(props)\n  }\n\n  function canHandleCreateIntent(params: Record<string, unknown>) {\n    // We can't handle create intents without a `type` parameter\n    if (!('type' in params)) {\n      return false\n    }\n\n    if ('presentation' in params && params.presentation !== toolName) {\n      return false\n    }\n\n    return 'template' in params ? {template: true} : true\n  }\n\n  function canHandleEditIntent(params: Record<string, unknown>) {\n    // We can't handle edit intents without `type` or `id` parameters\n    if (!('type' in params) || !('id' in params)) {\n      return false\n    }\n\n    if ('presentation' in params && params.presentation !== toolName) {\n      return false\n    }\n\n    return 'mode' in params ? {mode: params.mode === EDIT_INTENT_MODE} : true\n  }\n\n  return {\n    i18n: {\n      bundles: [presentationUsEnglishLocaleBundle],\n    },\n    document: {\n      unstable_fieldActions: (prev) => {\n        return [\n          ...prev.filter((a) => a.name !== openInStructure.name), // prevent duplication\n          openInStructure,\n        ]\n      },\n    },\n\n    form: {\n      components: {\n        input: PresentationDocumentInput,\n      },\n    },\n\n    tools: [\n      {\n        icon: options.icon || DEFAULT_TOOL_ICON,\n        name: toolName,\n        title: options.title,\n        component: PresentationTool,\n        options,\n        canHandleIntent(intent, params) {\n          if (intent === 'create') return canHandleCreateIntent(params)\n          if (intent === 'edit') return canHandleEditIntent(params)\n          return false\n        },\n        getIntentState,\n        router,\n        __internalApplicationType: 'sanity/presentation',\n      },\n    ],\n  }\n})\n","import {useContext} from 'react'\nimport {PresentationNavigateContext} from 'sanity/_singletons'\n\nimport {type PresentationNavigateContextValue} from './types'\n\n/** @public */\nexport function usePresentationNavigate(): PresentationNavigateContextValue {\n  const navigate = useContext(PresentationNavigateContext)\n\n  if (!navigate) {\n    throw new Error('Presentation navigate context is missing')\n  }\n\n  return navigate\n}\n\nexport type {PresentationNavigateContextValue}\n","import {useContext} from 'react'\nimport {PresentationParamsContext} from 'sanity/_singletons'\n\nimport {type PresentationParamsContextValue} from './types'\n\n/** @public */\nexport function usePresentationParams(throwOnMissingContext?: true): PresentationParamsContextValue\n/** @public */\nexport function usePresentationParams(\n  throwOnMissingContext: false,\n): PresentationParamsContextValue | null\n/** @public */\nexport function usePresentationParams(\n  throwOnMissingContext = true,\n): PresentationParamsContextValue | null {\n  const params = useContext(PresentationParamsContext)\n\n  if (throwOnMissingContext && !params) {\n    throw new Error('Presentation params context is missing')\n  }\n\n  return params\n}\n"],"names":["useSharedState","key","value","$","_c","context","useContext","PresentationSharedStateContext","Error","setValue","t0","t1","useEffect","DEFAULT_TOOL_ICON","ComposeIcon","DEFAULT_TOOL_NAME","DEFAULT_TOOL_TITLE","EDIT_INTENT_MODE","MAX_TIME_TO_OVERLAYS_CONNECTION","API_VERSION","apiVersion","MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL","LOADER_QUERY_GC_INTERVAL","POPUP_CHECK_INTERVAL","presentationLocaleNamespace","presentationUsEnglishLocaleBundle","defineLocaleResourceBundle","locale","namespace","resources","usePresentationPerspectiveStack","perspectiveStack","usePerspective","paneRouter","PaneRouterContext","scheduledDraftPerspective","params","scheduledDraft","INITIAL_STATE","locations","useDocumentLocations","props","id","resolvers","type","version","documentStore","useDocumentStore","documentPreviewStore","useDocumentPreviewStore","locationsState","setLocationsState","useState","resolver","name","locationsStatus","setLocationsStatus","bb0","undefined","_result","isObservable","of","doc","_type","_ref","preview","select","options","perspective","t2","resolve","snapshot","observeForPreview","pipe","map","result","sub","subscribe","state","unsubscribe","t3","status","usePresentationTool","throwOnMissingContext","presentation","PresentationContext","useCurrentPresentationToolName","TONE_ICONS","positive","InfoOutlineIcon","caution","WarningOutlineIcon","critical","ErrorOutlineIcon","LocationsBanner","documentId","schemaType","showPresentationTitle","isResolving","message","tone","locationsCount","length","t","useTranslation","presentationName","expanded","setExpanded","_temp","toggle","count","title","ToneIcon","Symbol","for","margin","t4","jsxs","Flex","jsx","Box","Text","Fragment","t5","Card","Spinner","ChevronRightIcon","transform","transition","Stack","l","active","areUrlsMatching","href","t6","t7","v","LocationItem","documentType","node","toolName","currentPresentationToolName","isCurrentTool","navigate","paneParams","usePaneRouter","structureParams","intent","mode","presentationLinkProps","useIntentLink","handleCurrentToolClick","onClick","DesktopIcon","t8","t9","previewUrlString","locationUrlString","previewUrl","URL","location","origin","locationUrl","pathname","locationParams","URLSearchParams","search","previewParams","entries","get","LocationStack","styled","div","theme","getTheme_v2","css","rem","space","PresentationDocumentHeader","PresentationDocumentContext","contextOptions","some","Boolean","hasResolvers","_options","idx","o","locate","PresentationDocumentProvider","children","parent","parentRegister","register","optionsArray","setOptionsArray","options_0","prev","concat","prev_0","filter","options_1","registerEffectEvent","useEffectEvent","useLayoutEffect","useOpenInStructureAction","path","workspace","useWorkspace","navigateIntent","useRouter","tools","findStructureTool","defaultStructureTool","icon","MasterDetailIcon","hidden","onAction","pathToString","renderAsButton","openInStructure","defineDocumentFieldAction","useAction","presentationToolName","results","match","canHandleIntent","tool","modeMatches","isRecord","preservedSearchParamKeys","getIntentState","routerState","payload","searchParams","_searchParams","includes","reduce","acc","window","getPublishedId","Object","templateParams","encodeJsonParams","uuid","PresentationSpinner","width","router","route","create","__unsafe_disableScopedSearchParams","intents","PresentationTool","lazy","BroadcastDisplayedDocument","defineLocations","defineDocuments","presentationTool","definePlugin","console","warn","hasLocationsResolver","PresentationDocumentInput","_id","getVersionFromId","documentVersion","isDocumentSchemaType","renderDefault","Suspense","canHandleCreateIntent","template","canHandleEditIntent","i18n","bundles","document","unstable_fieldActions","a","form","components","input","component","__internalApplicationType","usePresentationNavigate","PresentationNavigateContext","usePresentationParams","PresentationParamsContext"],"mappings":"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"}